(function(e){"use strict";redux.field_objects=redux.field_objects||{};redux.field_objects.typography=redux.field_objects.typography||{};var t=[];var n=false;var r={width:"resolve",triggerChange:true,allowClear:true};e(document).ready(function(){});redux.field_objects.typography.init=function(i){if(!i){i=e(document).find(".redux-container-typography")}e(i).each(function(){var i=e(this);var s=i;if(!i.hasClass("redux-field-container")){s=i.parents(".redux-field-container:first")}if(s.hasClass("redux-field-init")){s.removeClass("redux-field-init")}else{return}var o;i.each(function(){e(this).find(".redux-typography-container").each(function(){var t=e(this).find(".redux-typography-family");if(t.data("value")===undefined){t=e(this)}else if(t.data("value")!==""){e(t).val(t.data("value"))}var n=e(this).find(".select2_params");if(n.size()>0){var i=n.val();i=JSON.parse(i);r=e.extend({},r,i)}o=Boolean(e(this).find(".redux-font-clear").val());redux.field_objects.typography.select(t);window.onbeforeunload=null});e(this).find(".redux-typography").on("change",function(){redux.field_objects.typography.select(e(this))});e(this).find(".redux-typography-size, .redux-typography-height, .redux-typography-word, .redux-typography-letter, .redux-typography-align, .redux-typography-transform, .redux-typography-font-variant, .redux-typography-decoration").keyup(function(){redux.field_objects.typography.select(e(this).parents(".redux-container-typography:first"))});e(this).find(".redux-typography-color").wpColorPicker({change:function(t,n){redux_change(e(this));e(this).val(n.color.toString());redux.field_objects.typography.select(e(this))}});e(this).find(".redux-typography-size").numeric({allowMinus:false});e(this).find(".redux-typography-height, .redux-typography-word, .redux-typography-letter").numeric({allowMinus:true});var s=[{id:"none",text:"none"}];e(this).find(".redux-typography-family").select2({matcher:function(e,t){return t.toUpperCase().indexOf(e.toUpperCase())===0},query:function(e){return window.Select2.query.local(s)(e)},initSelection:function(e,t){var n={id:e.val(),text:e.val()};t(n)},allowClear:o}).on("select2-opening",function(t){var n=e(this).parents(".redux-container-typography:first").attr("data-id");var r=e("#"+n+" .redux-typography-font-family").data("user-fonts");r=r?1:0;var i=e("#"+n+" .redux-typography-google").val();i=i?1:0;var o=[];if(redux.customfonts!==undefined){o.push(redux.customfonts)}if(redux.stdfonts!==undefined&&r===0){o.push(redux.stdfonts)}if(r==1){var u=[];for(var a in redux.typography[n]){var f=redux.typography[n].std_font;for(var l in f){if(f.hasOwnProperty(l)){u.push({id:l,text:l,"data-google":"false"})}}}var c={text:"Standard Fonts",children:u};o.push(c)}if(i==1||i===true&&redux.googlefonts!==undefined){o.push(redux.googlefonts)}s=o;var h=e("#"+n+" #"+n+"-family").attr("placeholder");if(!h){h=null}e("#"+n+" .redux-typography-family").select2("val",h)}).on("select2-selecting",function(r,i){var s=r.object.text;var o=e(this).parents(".redux-container-typography:first").attr("data-id");e("#"+o+" #"+o+"-family").data("value",s);e("#"+o+" #"+o+"-family").attr("placeholder",s);t=r;n=true;redux_change(e(this))}).on("select2-clearing",function(t,n){var r=e(this).parents(".redux-container-typography:first").attr("data-id");e("#"+r+" #"+r+"-family").attr("data-value","");e("#"+r+" #"+r+"-family").attr("placeholder","Font Family");e("#"+r+" #"+r+"-google-font").val("false");redux_change(e(this))});var u=i.find(".redux-typography-family");if(!u.hasClass("redux-typography-family")){i.find(".redux-typography-style").select2(r)}i.find(".redux-typography-family-backup, .redux-typography-align, .redux-typography-transform, .redux-typography-font-variant, .redux-typography-decoration").select2(r)})})};redux.field_objects.typography.size=function(e){var t=0,n;for(n in e){if(e.hasOwnProperty(n)){t++}}return t};redux.field_objects.typography.makeBool=function(e){if(e=="false"||e=="0"||e===false||e===0){return false}else if(e=="true"||e=="1"||e===true||e==1){return true}};redux.field_objects.typography.contrastColour=function(e){var t="#444444";if(e!==""){e=e.replace("#","");var n=parseInt(e.substr(0,2),16);var r=parseInt(e.substr(2,2),16);var i=parseInt(e.substr(4,2),16);var s=(n*299+r*587+i*114)/1e3;t=s>=128?"#444444":"#ffffff"}return t};redux.field_objects.typography.select=function(i){var s=e(i).parents(".redux-container-typography:first").attr("data-id");var o=e("#"+s+" #"+s+"-family").val();if(!o){o=null}var u=e("#"+s+" select.redux-typography-family-backup").val();var a=e("#"+s+" .redux-typography-size").val();var f=e("#"+s+" .redux-typography-height").val();var l=e("#"+s+" .redux-typography-word").val();var c=e("#"+s+" .redux-typography-letter").val();var h=e("#"+s+" select.redux-typography-align").val();var p=e("#"+s+" select.redux-typography-transform").val();var d=e("#"+s+" select.redux-typography-font-variant").val();var v=e("#"+s+" select.redux-typography-decoration").val();var m=e("#"+s+" select.redux-typography-style").val();var g=e("#"+s+" select.redux-typography-subsets").val();var y=e("#"+s+" .redux-typography-color").val();var b=e("#"+s).data("units");wtd_typo_change(s,o,a,p,d,v,m,y,b);var w;if(n===true){w=redux.field_objects.typography.makeBool(t.object["data-google"]);e("#"+s+" .redux-typography-google-font").val(w)}else{w=redux.field_objects.typography.makeBool(e("#"+s+" .redux-typography-google-font").val())}if(!e("#"+s).hasClass("typography-initialized")){m=e("#"+s+" select.redux-typography-style").data("value");g=e("#"+s+" select.redux-typography-subsets").data("value");if(m!==""){m=String(m)}if(typeof g!==undefined){g=String(g)}}if(redux.fonts.google===undefined){w=false}var E="";if(w===true&&o in redux.fonts.google){E=redux.fonts.google[o]}else{E={400:"Normal 400",700:"Bold 700","400italic":"Normal 400 Italic","700italic":"Bold 700 Italic"}}if(e(i).hasClass("redux-typography-subsets")){e("#"+s+" input.typography-subsets").val(g)}if(e(i).hasClass("redux-typography-family")){var S='<option value=""></option>';if(w===true){var x="";e.each(E.variants,function(e,t){if(t.id===m||redux.field_objects.typography.size(E.variants)===1){x=' selected="selected"';m=t.id}else{x=""}S+='<option value="'+t.id+'"'+x+">"+t.name.replace(/\+/g," ")+"</option>"});e("#"+s+" .redux-typography-style").select2("destroy");e("#"+s+" .redux-typography-style").html(S);e("#"+s+" .redux-typography-style").select2(r);x="";S='<option value=""></option>';e.each(E.subsets,function(t,n){if(n.id===g||redux.field_objects.typography.size(E.subsets)===1){x=' selected="selected"';g=n.id;e("#"+s+" input.typography-subsets").val(g)}else{x=""}S+='<option value="'+n.id+'"'+x+">"+n.name.replace(/\+/g," ")+"</option>"});e("#"+s+" .redux-typography-subsets").select2("destroy");e("#"+s+" .redux-typography-subsets").html(S);e("#"+s+" .redux-typography-subsets").select2(r);e("#"+s+" .redux-typography-subsets").parent().fadeIn("fast");e("#"+s+" .typography-family-backup").fadeIn("fast")}else{if(E){e.each(E,function(t,n){if(t===m||t==="normal"){x=' selected="selected"';e("#"+s+" .typography-style .select2-chosen").text(n)}else{x=""}S+='<option value="'+t+'"'+x+">"+n.replace("+"," ")+"</option>"});e("#"+s+" .redux-typography-style").select2("destroy");e("#"+s+" .redux-typography-style").html(S);e("#"+s+" .redux-typography-style").select2(r);e("#"+s+" .redux-typography-subsets").parent().fadeOut("fast");e("#"+s+" .typography-family-backup").fadeOut("fast")}}e("#"+s+" .redux-typography-font-family").val(o)}else if(e(i).hasClass("redux-typography-family-backup")&&u!==""){e("#"+s+" .redux-typography-font-family-backup").val(u)}if(e("#"+s+" select.redux-typography-style option[value='"+m+"']").length===0){m="";e("#"+s+" select.redux-typography-style").select2("val","")}else if(m==="400"){e("#"+s+" select.redux-typography-style").select2("val",m)}if(e("#"+s+" select.redux-typography-subsets option[value='"+g+"']").length===0){g="";e("#"+s+" select.redux-typography-subsets").select2("val","");e("#"+s+" input.typography-subsets").val(g)}var T="style_link_"+s;e("."+T).remove();if(o!==null&&o!=="inherit"&&e("#"+s).hasClass("typography-initialized")){var N=o.replace(/\s+/g,"+");if(w===true){var C=N;if(m){C+=":"+m.replace(/\-/g," ")}if(g){C+="&subset="+g}if(typeof WebFont!=="undefined"&&WebFont){WebFont.load({google:{families:[C]}})}e("#"+s+" .redux-typography-google").val(true)}else{e("#"+s+" .redux-typography-google").val(false)}}if(m.indexOf("italic")!==-1){e("#"+s+" .typography-preview").css("font-style","italic");e("#"+s+" .typography-font-style").val("italic");m=m.replace("italic","")}else{e("#"+s+" .typography-preview").css("font-style","normal");e("#"+s+" .typography-font-style").val("")}e("#"+s+" .typography-font-weight").val(m);if(!f){f=a}if(a===""){e("#"+s+" .typography-font-size").val("")}else{e("#"+s+" .typography-font-size").val(a+b)}if(f===""){e("#"+s+" .typography-line-height").val("")}else{e("#"+s+" .typography-line-height").val(f+b)}if(l===""){e("#"+s+" .typography-word-spacing").val("")}else{e("#"+s+" .typography-word-spacing").val(l+b)}if(c===""){e("#"+s+" .typography-letter-spacing").val("")}else{e("#"+s+" .typography-letter-spacing").val(c+b)}if(e("#"+s).hasClass("typography-initialized")){var k=e("#"+s+" .typography-preview").data("preview-size");if(k=="0"){e("#"+s+" .typography-preview").css("font-size",a+b)}e("#"+s+" .typography-preview").css("font-weight",m);e("#"+s+" .typography-preview").css("font-family",o+", sans-serif");if(o==="none"&&o===""){e("#"+s+" .typography-preview").css("font-family","inherit")}e("#"+s+" .typography-preview").css("line-height",f+b);e("#"+s+" .typography-preview").css("word-spacing",l+b);e("#"+s+" .typography-preview").css("letter-spacing",c+b);if(y){e("#"+s+" .typography-preview").css("color",y);e("#"+s+" .typography-preview").css("background-color",redux.field_objects.typography.contrastColour(y))}e("#"+s+" .typography-style .select2-chosen").text(e("#"+s+" .redux-typography-style option:selected").text());e("#"+s+" .typography-script .select2-chosen").text(e("#"+s+" .redux-typography-subsets option:selected").text());if(h){e("#"+s+" .typography-preview").css("text-align",h)}if(p){e("#"+s+" .typography-preview").css("text-transform",p)}if(d){e("#"+s+" .typography-preview").css("font-variant",d)}if(v){e("#"+s+" .typography-preview").css("text-decoration",v)}e("#"+s+" .typography-preview").slideDown()}if(!e("#"+s).hasClass("typography-initialized")){e("#"+s).addClass("typography-initialized")}n=false}})(jQuery)
